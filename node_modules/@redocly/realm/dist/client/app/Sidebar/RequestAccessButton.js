import r,{useEffect as I,useState as a}from"react";import N from"styled-components";import{useLocation as C}from"react-router-dom";import{Button as y}from"@redocly/theme/components/Button/Button";import{Admonition as k}from"@redocly/theme/markdoc/components/Admonition/Admonition";import{usePageData as q}from"@portal/hooks/usePageData";import{usePreloadHistory as w}from"@portal/usePreloadHistory";import{telemetry as T}from"@portal/telemetry";import{useLoginUrl as b}from"../hooks";const O=e=>{const{apiId:s,status:t,setStatus:o}=e,u=w(),{userData:n}=q("userData")||{},h=C(),i=b(),[l,p]=a(),[E,g]=a(),[m,A]=a(!0);I(()=>{n?.isAuthenticated&&fetch(`/api/api-keys/api-products/${s}/access`).then(d=>d.json().then(c=>{d.ok?(o(c.status),g(c.appId)):p(c.message)}).catch(()=>p("Something went wrong")).finally(()=>A(!1)))},[n?.isAuthenticated,s,o]);const P=()=>{!n?.isAuthenticated&&i?window.location.href=`${i}${i.includes("?")?"&":"?"}redirectTo=${h.pathname}`:t==="ACCEPTED"?u.push("/apps/"+E||""):t==="NONE"&&u.push("/apps/?createApp&apiId="+s),T.send("request_api_access_button_clicked",{action:"click"})},D=(t==="PENDING"||m||l!=null)&&n?.isAuthenticated;return r.createElement(r.Fragment,null,r.createElement(y,{disabled:D,onClick:P,fullWidth:!0,size:"small"},x(t,m,l,!!n?.isAuthenticated)))},x=(e,s,t,o)=>{if(!o)return"Request access";if(s)return"Loading...";if(t)return"Failed to check access";switch(e){case"NONE":return"Request access";case"ACCEPTED":return"Credentials";case"PENDING":return"Pending access..."}return null},U=e=>e==="ACCEPTED"?r.createElement(f,{type:"success",name:"You have access to this API"}):e==="PENDING"?r.createElement(f,{type:"info",name:"You have requested access to this API"}):null,f=N(k)`
  margin-top: 0px;
  margin-bottom: var(--spacing-sm);
`;export{O as RequestAccessButton,U as renderAdmonition};
