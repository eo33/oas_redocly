import{useState as s}from"react";import{useI18nConfig as A,useCurrentProduct as C}from"../hooks";import{withPathPrefix as I}from"../utils";import{ServerRoutes as O}from"../../../shared/constants";function T(l){const[d,c]=s(),[m,a]=s([]),[h,p]=s(""),[g,t]=s(!1),{currentLocale:R}=A(),S=C();return{askQuestion:async r=>{r&&(c(""),a([]),t(!0),p(r),fetch(I(O.ASK_AI),{method:"POST",body:JSON.stringify({text:r,locale:R,product:S?.name,filter:l?.filter})}).then(x=>{let i="";const u=x.body;if(!u)return;const w=u.getReader(),f=()=>{w.read().then(({value:o,done:k})=>{if(k){t(!1);return}const y=new TextDecoder().decode(o),P=/data: (.*)/g;let n;for(;(n=P.exec(y))!==null;){if(!n[1])continue;const e=JSON.parse(n[1]);e.answer?(i+=e.answer,c(i)):e.sources&&a(e.sources.slice(0,5))}f()}).catch(o=>{console.error(o),t(!1)})};f()}))},isGeneratingResponse:g,response:d,resources:m,question:h}}export{T as useAiSearch};
