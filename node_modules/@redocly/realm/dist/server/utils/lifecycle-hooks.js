import{existsSync as p}from"fs";import*as n from"path";import{loadEnvironmentVariables as f}from"../../shared/env.js";import{cliCommandNames as o}from"../constants.js";import{PUBLIC_STATIC_FOLDER as a}from"../../shared/constants.js";import{copyFolderRecursiveSync as c}from"./fs.js";import i from"./reporter/logger.js";import{validateInstalledVersion as l}from"./validate-installed-version.js";import{blue as u,gray as E}from"./reporter/colors.js";import{PACKAGE_NAME as P}from"../../config/product-gates.js";import{PORTAL_VERSION as v}from"../version.js";function O(e){return e?"true":"false"}function R(e){return e?"true":"false"}function d(e){return p(n.resolve(e))?!0:(i.warn("The specified HTML Template does not exist at %rp: ",e),!1)}function s(e,r){const t=e.htmlTemplate;t&&d(t)&&r.setCliOptions({customHtmlTemplate:t}),process.env.REPORTER_VERBOSE=O(e.verbose),process.env.INSPECT_MODE=R(e.inspect),e.pathPrefix&&(process.env.REDOCLY_PREFIX_PATHS=e.pathPrefix)}function C({contentDir:e,outdir:r}){c(n.join(e,a),r)}async function N(e,r,t){f(r["project-dir"]),process.env.REDOCLY_RUNNING_COMMAND=e;const m=e===o.DEVELOP?"  Previewing with":"Building with";switch(i.logSticky("product",`${m} ${u(`${P}@${v}`)}`),i.logSticky("server",`  \u{1F310} Preview URL: ${E("server starting...")}`),e){case o.DEVELOP:s(r,t);break;case o.BUILD:s(r,t);break;default:break}await l(),C(t)}export{N as beforeCommand};
