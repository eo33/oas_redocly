import m from"path";import{readFile as s,writeFileSync as f}from"fs";import{ensureDir as d}from"./fs.js";import{getSharedDataUrl as l}from"../../shared/urls.js";import p from"./reporter/logger.js";const n={},y=async(r,e,t)=>{const o=a(r,t);await n[r],f(d(o),e,{encoding:"utf-8",flush:!0})},P=async(r,e)=>{try{const t=new Promise(o=>s(a(r,e),"utf-8",(i,c)=>{o(i?void 0:JSON.parse(c))}));return n[r]=t,t.finally(()=>{delete n[r]})}catch{p.warnProd(`Failed to read shared data: ${r}`);return}},a=(r,e)=>m.join(e,l(r));export{P as readSharedData,y as writeSharedData};
