import*as g from"node:path";import{maskEmail as O}from"./masker.js";import{red as R,green as T,bold as C,blue as p,gray as n,yellow as E,cyan as P}from"./colors.js";import{isProductionMode as A}from"../../../shared/env.js";var s;(function(e){e.INFO="INFO",e.WARN="WARN",e.ERROR="ERROR",e.SUCCESS="SUCCESS",e.VERBOSE="VERBOSE",e.HTTP="HTTP"})(s||(s={}));const w={[s.INFO]:p,[s.SUCCESS]:T,[s.WARN]:E,[s.ERROR]:R,[s.HTTP]:P,[s.VERBOSE]:n},$={"%ap":e=>p(g.resolve(e)),"%rp":e=>p(g.relative(process.cwd(),e)),"%s":e=>e?.toString(),"%c":e=>p(e)},b={format(e){switch(process.env.PORTAL_LOG_FORMAT){case"JSON":return j(e);default:return N(e)}},interpolate(e,...c){const i=Object.keys($).map(t=>`(${t})`).join("|"),a=new RegExp(i,"g");let r,m=e;for(;(r=a.exec(e))!==null;){r.index===a.lastIndex&&a.lastIndex++;const t=c.shift();if(t===void 0)break;const o=r[0];m=m.replace(o,$[o](t))}return m}};var D=b;const N=e=>{const{level:c,message:i,duration:a,context:r}=e,m=A(),t=[w[c](C(`[${c.toLowerCase()}]`))];if(m&&t.push(n(`time="${x()}"`)),r){const{email:o,ipAddress:u,subject:l,method:f,pathname:d,statusCode:h,teams:S}=r;h&&t.push(I(h)),e.level===s.HTTP&&(f&&t.push(n(`method="${f}"`)),d&&t.push(n(`path="${d}"`))),u&&t.push(n(`ip="${u}"`)),o&&t.push(n(`email="${O(o)}"`)),l&&t.push(n(`sub="${l}"`)),S?.length&&t.push(n(`teams="${S.join(", ")}"`))}if(i){const o=m?`msg="${String(i).replaceAll?.('"','\\"')}"`:String(i);t.push(o)}return e.level===s.HTTP&&r?.userAgent&&t.push(n(`agent="${r.userAgent}"`)),a&&t.push(H(a)),t.join(" ")+`
`},j=({context:e,message:c,...i})=>{const{method:a,pathname:r,statusCode:m,userAgent:t,subject:o,email:u,teams:l}=e||{},f={...i,email:u&&O(u),subject:o,teams:l,...i.level===s.HTTP?{method:a,pathname:r,statusCode:m,userAgent:t}:{message:String(c)}};return A()&&(f.time=x()),JSON.stringify(f,["time","level","scope","message","duration","method","pathname","statusCode","userAgent","subject","ipAddress","email"])+`
`},I=e=>(e%500<100?R:e%400<100?E:T)(`status="${e}"`),x=()=>{let e=new Date().getTimezoneOffset()*6e4;return new Date(Date.now()-e).toISOString().slice(0,-1)},H=e=>n(`dur="${Math.round(e)}ms"`);export{s as LogLevel,D as default};
