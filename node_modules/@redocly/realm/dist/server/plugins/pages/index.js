import p from"node:path";import{staticDataLoader as u}from"./page-data-loaders/static-data-loader.js";import{REDOCLY_TEAMS_RBAC as g}from"../../../shared/constants.js";import{resolveSidebarId as h}from"../sidebars/index.js";import{resolveFrontmatterSlugs as b}from"../utils.js";import{Feature as y}from"../../entitlements/entitlements.types.js";import{slash as v}from"../../../shared/utils.js";import{reactFrontmatterLoader as P}from"./react-frontmatter-loader.js";async function F(){return{loaders:{"react-frontmatter":P},id:"react-pages",requiredEntitlements:[y.ReactPages],processContent:async(a,r)=>{const{fs:n,cache:f}=r;for(const{relativePath:e,realRelativePath:m}of await n.scan(/\.page\.tsx?$/)){if(await r.isPathIgnored(e))continue;const l=a.createTemplate(v(e),p.resolve(n.cwd,m)),{data:t}=await f.load(e,"react-frontmatter"),o=b(t?.slug,e);let s=null;t?.sidebar&&typeof t?.sidebar!="object"&&(s=await h(e,t.sidebar,r.fs)),(o.length?o.reverse():[void 0]).forEach(i=>{a.addRoute({slug:i,templateId:l,fsPath:e,sharedData:s?[{id:s,key:"sidebar"}]:void 0,[g]:t?.rbac,getNavText:async()=>t?.seo?.title,getStaticData:async(c,d)=>({props:await u({frontmatter:t,relativePath:e},r,d)})})});for(const[i,{to:c,type:d}]of Object.entries(t?.redirects||{}))a.addRedirect(i,{to:c||o[0],type:d||301})}}}}export{F as customPagesPlugin};
