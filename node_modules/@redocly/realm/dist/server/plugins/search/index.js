import{prepareSearchDocuments as f}from"./documents/search-documents.js";import{SearchEngine as h}from"./engines/search-engine.js";import{DEFAULT_SEARCH_ENGINE as t}from"./constants.js";import{isDevelopMode as o}from"../../utils/is-develop-mode.js";import{prepareAiSearchDocuments as m}from"./ai-indexer/prepare-ai-search-documents.js";async function d(){let r=!0;return{async afterRoutesCreated(e,a){(process.env.SEARCH_DEV_REINIT||r)&&await p(a.fs,e),r=!1},id:"search"}}async function p(r,e){const a=e.getConfig(),i=a.search?.engine||t,c=o()?process.env.SEARCH_DEV_DEBUG?i:t:i,{l10n:E}=e.getGlobalData(),s=o()?process.env.SEARCH_DEV_DEBUG==="true":!(a.search?.ai?.hide??!0),n=new h(c,E);await n.initIndexSchema(e.getSearchFacets()),e.setSearchEngine(n),e.setGlobalData({advancedSearch:c!==t,askAi:s}),await f(r,e,n),s&&await m(e)}export{d as searchPlugin};
