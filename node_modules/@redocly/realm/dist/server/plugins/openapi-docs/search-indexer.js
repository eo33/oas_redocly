import*as l from"@redocly/openapi-docs";import{REDOCLY_TEAMS_RBAC as d}from"../../../shared/constants.js";import{removeMarkdownLinks as n}from"./utils.js";import{combineUrls as h}from"../../../shared/urls.js";const u=l.default||l;class P{parser;options;basePath;resultArray=[];constructor(e,t,r){this.parser=e,this.options=t,this.basePath=r}addItem(e){switch(e.type){case"tag":this.addTag(e);break;case"operation":const t=u.getOperation(this.parser,e.operationDefinition,e.parent,{...this.options,internal_skipSamples:!0},e.href);this.addOperation(t,e[d]);break;case"section":this.addSection(e);break}}addInfo(e,t){const r=this.basePath;this.resultArray.push({id:r,url:r,text:n(e.description||""),title:`${e.title} (${e.version})`,metadata:t})}getResult(){return this.resultArray}getParameterId(e){return e.name+e.description+e.place}addOperation(e,t){if(e.type!=="operation")return;let r={};for(let s of e.parameters){if(s[d])continue;const a={name:s.name,description:n(s.description),place:s.in+" parameters",[d]:s[d]};r[this.getParameterId(a)]=a}this.addSchema(r,e.requestBody?.content?.mediaTypes[0]?.schema,"request fields",!1);for(let s of e.responses)this.addSchema(r,s.content?.mediaTypes[0]?.schema,`response ${s.code} fields`,!0);let i=h(this.basePath,e.href);this.resultArray.push({id:i,url:i,title:e.name,text:n(e.description||""),httpMethod:e.httpVerb,httpPath:e.path,deprecated:e.deprecated,parameters:Object.values(r),badges:e.badges.length?e.badges:void 0,[d]:t})}addSchema(e,t,r,i,s=[]){if(!(!t||t.isCircular)){if(t?.fields)for(let a of t.fields){if(t[d])continue;const o=s.concat([a.name]);if(a.kind==="additionalProperties"||a.schema?.readOnly&&!i||a.schema?.writeOnly&&i)continue;const c={name:a.name,description:n(a.description),place:r,path:o.slice(0,-1)},p=this.getParameterId(c);e[p]==null&&(e[p]=c,this.addSchema(e,a.schema,r,i,o))}t?.items&&this.addSchema(e,t.items,r,i,s)}}addTag(e){const t=h(this.basePath,e.href);this.resultArray.push({id:t,url:t,text:n(e.description||""),title:e.name})}addSection(e){const t=h(this.basePath,e.href);this.resultArray.push({id:t,url:t,text:n(e.description||""),title:e.name})}}export{P as SearchIndexer};
