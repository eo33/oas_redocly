import{isDevelopMode as a}from"../../utils/is-develop-mode.js";import{DEFAULT_SSO_IDP_TITLE as l}from"../../../shared/constants.js";const p="https://auth.cloud.redocly.com/oidc/.well-known/openid-configuration";async function y(d){return{id:"sso",async processContent(o){const e=o.getConfig();if(e.ssoDirect&&typeof e.ssoDirect=="object"&&Object.keys(e.ssoDirect).length!==0||e.sso&&Array.isArray(e.sso)&&!e.sso.length)return;const i=!!(e.rbac&&typeof e.rbac=="object"&&Object.keys(e.rbac).length!==0),r=e.requiresLogin;if(!i&&!r)return;let n=p;const s=e.residency;s&&(n=`${(s.endsWith("/")?s.slice(0,-1):s).replace("app.","auth.")}/oidc/.well-known/openid-configuration`);let t="AUTO";e.sso&&(Array.isArray(e.sso)?t=e.sso.join(","):t=e.sso);const c={oidc:{title:l,type:"OIDC",configurationUrl:n,clientId:"{{ process.env.OAUTH_CLIENT_ID }}",clientSecret:"{{ process.env.OAUTH_CLIENT_SECRET }}",teamsClaimName:"https://redocly.com/sso/teams",scopes:["openid"],authorizationRequestCustomParams:{login_hint:"{{ process.env.ORG_ID }}",login_type:t,prompt:"login"},audience:"{{ process.env.ORG_ID }}"}};o.setGlobalConfig({ssoDirect:c}),o.loadEnvConfig(a())},async afterRoutesCreated(o){}}}export{y as ssoPlugin};
