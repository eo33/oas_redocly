import T from"@markdoc/markdoc";import{basename as $}from"node:path";import{walkSections as k}from"./walk-sections.js";import{getLocaleFromRelativePath as C}from"../../../fs/utils/get-locale-from-relative-path.js";import{isStringNode as p}from"../markdoc/utils/is-sting-node.js";import{extractDocumentSearchFacets as P}from"./search-facets.js";const W=t=>async(e,r)=>{if(r.frontmatter?.excludeFromSearch)return[];const a=e.fsPath,o=await e.getNavText?.()||$(a),s=e.slug;let l=[];const c=[],m=T.Ast.fromJSON(r.ast),h=k(m),g=e.metadata||{},S=P(g,t);let i=o,u=s;for(const n of h)if(p(n)||n.attributes.level>4)F({chunks:c,section:n,chunkTitle:i,chunkUrl:u});else{const b=j(l,n).map(x=>d(x)).join(`
`),f=n.attributes.level>2;i=f?u:w(o,n),u=f?i:n.getUrl(s),c.push({content:"",header:b,title:i,url:u})}const v=C(a);return c.filter(n=>n.content).map(n=>({title:n.title,url:n.url,content:[n.header,n.content.trim()].filter(Boolean).join(`

`),fsPath:a,locale:v,product:e.product?.name,facets:S}))};function j(t,e){const r=e.attributes.level-1;return t.splice(r,6),t.push(e),t}function w(t,e){return e.content===t?t:`${t} \u2192 ${e.content}`}function F({chunks:t,section:e,chunkTitle:r,chunkUrl:a}){const o=t[t.length-1],s=o?.content.endsWith(`
`),l=!p(e),c=l?`
${d(e)}
`:e,m=s||l?"":" ";o?o.content=[o.content,c].filter(Boolean).join(m):t.push({title:r,url:a,header:"",content:c})}function d(t){return`${"#".repeat(t.attributes.level)} ${t.content}`}export{W as getAiSearchDocuments};
