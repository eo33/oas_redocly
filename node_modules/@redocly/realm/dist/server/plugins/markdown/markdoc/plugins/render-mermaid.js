import{nanoid as l}from"nanoid";import{sha as s}from"../../../../utils/crypto.js";import{logger as m}from"../../../../utils/index.js";const i={};async function E(t,h="default"){if(t.length===0)return[];const r=[];for(let e=0;e<t.length;e++){const n=s(t[e]);i[n]||r.push(t[e])}if(r.length){const e=process.env.REDOCLY_MERMAID_MICROSERVICE_URL||"https://api.redocly.com/mermaid",n=m.startTiming(),c=l(),d=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json","x-request-id":process.env.REQUEST_ID||""},body:JSON.stringify({definitions:r,rayId:c,theme:h,organizationId:process.env.ORGANIZATION_ID})});if(d.status!==200)throw new Error(`Something went wrong during remote rendering. Please, save this Ray ID: ${c} and contact Redocly team.`);m.verboseTime(n,"Rendered mermaid diagrams (%s)",r.length);const g=await d.json();for(let o=0;o<r.length;o++){const p=s(r[o]);i[p]=g[o]}}const a=[];for(let e=0;e<t.length;e++){const n=s(t[e]);a.push(i[n])}return a}export{i as cache,E as renderMermaid};
