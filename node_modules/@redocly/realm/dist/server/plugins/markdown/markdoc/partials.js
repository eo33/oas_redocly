import*as f from"path";import{MARKDOC_PARTIALS_DATA_KEY as n}from"../../../store.js";import{isPartial as m}from"../is-partial.js";function p(t,r){return Promise.all(t.map(r)).then(i=>t.filter((s,e)=>i[e]))}async function h(t,r){const{markdown:i}=await t.getConfig(),s=i?.partialsFolders??[],e=await p(await t.fs.scan(/\.md$/),async a=>!(!f.posix.basename(a.relativePath).endsWith(".md")||await t.isPathIgnored(a.relativePath)||!m(a.relativePath,s)));r.setGlobalConfig({[n]:Object.fromEntries(e.map(a=>[a.relativePath,{}]))});const o={};for(const a of e){const{ast:l}=await r.parseMarkdoc(a,t);o[a.relativePath]=l}r.setGlobalConfig({[n]:o})}export{h as prepareMarkdocPartials};
