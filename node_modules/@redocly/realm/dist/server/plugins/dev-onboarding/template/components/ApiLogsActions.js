import n,{useMemo as D,useState as O}from"react";import{Popup as h}from"reactjs-popup";import l from"styled-components";import{useQuery as N}from"@tanstack/react-query";import{DateTimeRangePicker as R}from"@wojtekmaj/react-datetimerange-picker";import"@wojtekmaj/react-datetimerange-picker/dist/DateTimeRangePicker.css";import{fetch as S}from"@portal/utils";import{PopupMenuUl as I}from"./PopupMenuUl";const A=[{name:"OTHER",id:"OTHER"},{name:"CONNECT",id:"CONNECT"},{name:"DELETE",id:"DELETE"},{name:"GET",id:"GET"},{name:"HEAD",id:"HEAD"},{name:"OPTIONS",id:"OPTIONS"},{name:"PATCH",id:"PATCH"},{name:"POST",id:"POST"},{name:"PUT",id:"PUT"},{name:"TRACE",id:"TRACE"}],y=[{type:"predefined",name:"last 5m",fromDateOffset:1e3*60*5},{type:"predefined",name:"last 1h",fromDateOffset:1e3*60*60},{type:"predefined",name:"last 3h",fromDateOffset:1e3*60*60*3},{type:"predefined",name:"last 12h",fromDateOffset:1e3*60*60*12},{type:"predefined",name:"last 1d",fromDateOffset:1e3*60*60*24},{type:"predefined",name:"last 3d",fromDateOffset:1e3*60*60*24*3},{type:"predefined",name:"last 7d",fromDateOffset:1e3*60*60*24*7},{type:"predefined",name:"last 30d",fromDateOffset:1e3*60*60*24*30}],P=[{name:"100 CONTINUE",id:"100"},{name:"101 SWITCHING PROTOCOLS",id:"101"},{name:"102 PROCESSING",id:"102"},{name:"200 OK",id:"200"},{name:"201 CREATED",id:"201"},{name:"202 ACCEPTED",id:"202"},{name:"203 NON AUTHORITATIVE INFORMATION",id:"203"},{name:"204 NO CONTENT",id:"204"},{name:"205 RESET CONTENT",id:"205"},{name:"206 PARTIAL CONTENT",id:"206"},{name:"207 MULTI STATUS",id:"207"},{name:"300 MULTIPLE CHOICES",id:"300"},{name:"301 MOVED PERMANENTLY",id:"301"},{name:"302 FOUND",id:"302"},{name:"303 SEE OTHER",id:"303"},{name:"304 NOT MODIFIED",id:"304"},{name:"305 USE PROXY",id:"305"},{name:"307 TEMPORARY REDIRECT",id:"307"},{name:"400 BAD REQUEST",id:"400"},{name:"401 UNAUTHORIZED",id:"401"},{name:"402 PAYMENT REQUIRED",id:"402"},{name:"403 FORBIDDEN",id:"403"},{name:"404 NOT FOUND",id:"404"},{name:"405 METHOD NOT ALLOWED",id:"405"},{name:"406 NOT ACCEPTABLE",id:"406"},{name:"407 PROXY AUTHENTICATION REQUIRED",id:"407"},{name:"408 REQUEST TIMEOUT",id:"408"},{name:"409 CONFLICT",id:"409"},{name:"410 GONE",id:"410"},{name:"411 LENGTH REQUIRED",id:"411"},{name:"412 PRECONDITION FAILED",id:"412"},{name:"413 REQUEST ENTITY TOO LARGE",id:"413"},{name:"414 REQUEST URI TOO LONG",id:"414"},{name:"415 UNSUPPORTED MEDIA TYPE",id:"415"},{name:"416 REQUESTED RANGE NOT SATISFIABLE",id:"416"},{name:"417 EXPECTATION FAILED",id:"417"},{name:"422 UNPROCESSABLE ENTITY",id:"422"},{name:"423 LOCKED",id:"423"},{name:"424 FAILED DEPENDENCY",id:"424"},{name:"429 TOO MANY REQUESTS",id:"429"},{name:"500 INTERNAL SERVER ERROR",id:"500"},{name:"501 NOT IMPLEMENTED",id:"501"},{name:"502 BAD GATEWAY",id:"502"},{name:"503 SERVICE UNAVAILABLE",id:"503"},{name:"504 GATEWAY TIMEOUT",id:"504"},{name:"505 HTTP VERSION NOT SUPPORTED",id:"505"},{name:"507 INSUFFICIENT STORAGE",id:"507"}];function x(e){return n.createElement(L,null,n.createElement(w,{onFiltersChange:e.onFiltersChange,activeFilters:e.activeFilters}),n.createElement(U,null))}var K=n.memo(x);const U=()=>null,w=n.memo(e=>{const{onFiltersChange:d,activeFilters:t}=e,{data:i}=N(["API-PRODUCTS"],()=>S("/api/api-keys/api-products").then(o=>o.json())),[m,r]=O(),a=()=>r(void 0),s=(o,g)=>{const T={...t,[o]:g};d(T)};return n.createElement(h,{trigger:n.createElement(k,null,"Filter"),position:"bottom right"},n.createElement(_,null,n.createElement(E,{open:m==="api",name:"API name",options:i||[],activeOptions:t.api,onOpen:()=>r("api"),onClose:a,onChange:o=>s("api",o),active:(t.api?.length??0)>0}),n.createElement(E,{open:m==="status",name:"Status",options:P,activeOptions:t.status,onOpen:()=>r("status"),onClose:a,onChange:o=>s("status",o),active:(t.status?.length??0)>0}),n.createElement(E,{open:m==="method",name:"Method",options:A,activeOptions:t.method,onOpen:()=>r("method"),onClose:a,onChange:o=>s("method",o),active:(t.method?.length??0)>0}),n.createElement(E,{name:"Date range",open:m==="date",onOpen:()=>r("date"),onClose:a,active:!!t.date,renderSubmenu:()=>n.createElement(M,{onChange:o=>s("date",o),selectedDateFilter:t.date})}),n.createElement(b,null),n.createElement(H,{onClick:()=>d({})},"Clear filters")))}),M=e=>{const{selectedDateFilter:d,onChange:t}=e,i=d?.type==="custom",[m,r]=O(!1),[a,s]=O([null,null]),o=a?.[0]?a[0]:null,g=a?.[1]?a[1]:null,T=()=>{if(!a?.[0]&&!a?.[1])return t();const c=a[1]||new Date,p=a[0]||new Date(c.getDate()-1e3*60*60*24);r(!1),t({type:"custom",fromDate:p.getTime(),toDate:c.getTime()})};return n.createElement(v,{onMouseDown:u,onTouchStart:u},n.createElement(E,{open:m,active:i,name:"Custom range",onOpen:()=>r(!0),onClose:()=>r(!1),renderSubmenu:()=>n.createElement(F,null,n.createElement(Y,{onClick:T},"Submit"),n.createElement(b,null),n.createElement(R,{isCalendarOpen:!0,format:"yyyy-MM-dd HH:mm",closeWidgets:!1,dayPlaceholder:"DD",monthPlaceholder:"MM",yearPlaceholder:"YYYY",hourPlaceholder:"HH",minutePlaceholder:"mm",disableClock:!0,value:[o,g],minDetail:"decade",onChange:c=>s(c)}))}),y.map(c=>{const p=d?.type==="predefined"&&d.name===c.name;return n.createElement(f,{active:p,key:c.name,onClick:C=>{u(C),t(p?void 0:c)}},c.name)}))},E=e=>{const d=e.activeOptions||[],t=D(()=>new Set(d.map(i=>i.id)),[e.activeOptions]);return n.createElement(h,{open:e.open,onOpen:e.onOpen,onClose:e.onClose,trigger:n.createElement(f,{active:e.active||e.open},e.name),position:"left top",arrow:!1},e.options?n.createElement(v,{onMouseDown:u,onTouchStart:u},e.options?.map(i=>n.createElement(f,{active:t.has(i.id),key:i.id,onClick:m=>{if(e.onChange)if(u(m),t.has(i.id)){const r=[...d],a=r.findIndex(s=>s.id===i.id);r.splice(a,1),e.onChange(r)}else e.onChange([...d,i])}},i.name))):null,e.renderSubmenu?e.renderSubmenu():null)},u=e=>{e.stopPropagation()},k=l.div`
  color: var(--text-color-primary);
  border-radius: var(--border-radius);
  cursor: pointer;
  font-weight: var(--font-weight-bold);
  font-size: var(--font-size-base);
  padding: var(--spacing-xs) var(--spacing-sm);
  border: 1px solid var(--button-bg-color-secondary);
  background: var(--button-bg-color-secondary);

  &:hover {
    border-color: var(--border-color-primary);
  }
`,L=l.div`
  display: flex;
  gap: var(--spacing-xxs);
`,_=l(I)`
  padding: var(--spacing-xs);
  width: 288px;
  li {
    cursor: pointer;
    color: var(--text-color-secondary);
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-regular);
    padding: var(--spacing-xs);
    border-radius: var(--border-radius);
    &:hover {
      background-color: var(--bg-color-raised);
    }

    &:not(:last-child) {
      margin-bottom: 2px;
    }
  }
`,v=l(_)`
  max-height: 200px;
  overflow-y: scroll;
  &::-webkit-scrollbar {
    display: none;
  }
`,F=l(v)`
  max-height: unset;
  width: unset;
  padding: 0;
  padding-top: var(--spacing-xs);
  overflow: unset;

  .react-calendar__navigation {
    display: flex;
  }

  .react-calendar__navigation__prev2-button,
  .react-calendar__navigation__next2-button {
    display: none;
  }

  .react-datetimerange-picker {
    flex-direction: column;
  }

  .react-datetimerange-picker__wrapper {
    width: 350px;
    padding: var(--spacing-xs) var(--spacing-xs) 0 var(--spacing-xs);
    border: none;
    border-top-left-radius: var(--border-radius);
    border-top-right-radius: var(--border-radius);
    justify-content: space-around;
  }

  .react-calendar__tile,
  .react-calendar__month-view__weekdays__weekday {
    text-align: center;
  }

  .react-datetimerange-picker__inputGroup {
    flex-grow: 0;
  }

  .react-datetimerange-picker__inputGroup__input:invalid {
    background-color: var(--color-error-bg);
  }

  .react-calendar__month-view__days__day--neighboringMonth {
    opacity: 50%;
  }

  .react-calendar__tile:hover,
  .react-calendar__tile--hover,
  .react-calendar__tile--active {
    background-color: var(--button-bg-color-secondary-hover);
  }

  .react-calendar__tile--active:hover,
  .react-calendar__tile--now:hover {
    background-color: var(--button-bg-color-secondary-hover);
  }

  .react-calendar__tile--now {
    color: var(--color-primary-base);
  }

  .react-datetimerange-picker__inputGroup__input:invalid {
    background: transparent;
  }

  .react-calendar__navigation__arrow {
    text-align: center;
  }

  .react-datetimerange-picker__calendar {
    position: relative !important;
  }

  .react-calendar__navigation button {
    width: 44px;
    text-align: center;
  }

  .react-calendar__navigation__prev2-button,
  .react-calendar__navigation__next2-button {
    display: none;
  }

  .react-datetimerange-picker__clear-button,
  .react-datetimerange-picker__calendar-button {
    display: none;
  }

  .react-calendar {
    border: none;
    border-bottom-right-radius: var(--border-radius);
    border-bottom-left-radius: var(--border-radius);
    padding: var(--spacing-xs);
    font-family: var(--font-family-base);
  }
`,f=l.li`
  ${e=>e.active&&`
    background-color: var(--bg-color-raised);
  `}
`,H=l.li`
  opacity: 50%;
  cursor: pointer;
`,Y=l.li`
  cursor: pointer;
  opacity: 100%;
  font-size: var(--font-size-lg);
  text-align: center;
  margin: 0 var(--spacing-xs);
`,b=l.div`
  margin: var(--spacing-xs);
  width: auto;
  min-width: auto;
  background-color: var(--text-color-secondary);
  height: 1px;
  opacity: 0.1;
  list-style: none;
`;export{K as default};
