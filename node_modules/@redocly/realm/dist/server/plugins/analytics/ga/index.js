import{isProductionMode as s}from"../../../../shared/env.js";import{buildScripts as c}from"./build-scripts.js";import{resolveBrowserHooksPath as l}from"./resolve-browser-hooks.js";import{Feature as u}from"../../../entitlements/entitlements.types.js";import{withPathPrefix as g}from"../../../../shared/urls.js";async function h(){const n=s();return{id:"Google Analytics",requiredEntitlements:[u.Analytics],afterRoutesCreated(t){const r=t.getGlobalData()||{},o=r.analytics?.ga||{trackingId:""};o?.exclude||(o.exclude=[]),o.trackers={};for(const i of Object.values(r.products||{})){const e=i.configOverride?.analytics?.ga;!e||!n&&!e.includeInDevelopment||(e.exclude?.length&&o.exclude.push(...e.exclude),o.trackers[i.slug]=e)}if(o.trackingId&&(n||o.includeInDevelopment)&&(o.trackers[g("/")]={trackingId:o.trackingId,conversionId:o.conversionId,floodlightId:o.floodlightId,optimizeId:o.optimizeId}),t.setGlobalData({...r,analytics:{...r?.analytics,ga:o}}),!Object.keys(o.trackers).length)return;const{headComponents:a,postBodyComponents:d}=c(o);t.addSsrComponents(a,"head"),t.addSsrComponents(d,"postBody"),t.addBrowserPlugin(l())}}}export{h as googleAnalyticsPlugin};
