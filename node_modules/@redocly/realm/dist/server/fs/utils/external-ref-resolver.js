import{BaseResolver as i,ResolveError as l,Source as a,isAbsoluteUrl as h,readFileFromUrl as m}from"@redocly/openapi-core";import f from"path";import{slash as p}from"../../../shared/utils.js";class x extends i{fs;constructor(e){super(),this.fs=e}async resolveDocument(e,t,r=!1){const s=this.resolveExternalRef(e,t),o=this.cache.get(s);if(o)return o;const n=this.loadExternalRef(s).then(c=>this.parseDocument(c,r));return this.cache.set(s,n),n}async loadExternalRef(e){try{if(h(e)){const{body:t,mimeType:r}=await m(e,this.config.http);return new a(e,t,r)}else{const t=p(f.relative(this.fs.cwd,e)),r=await this.fs.read(t);return new a(e,r.replace(/\r\n/g,`
`))}}catch(t){throw t.message=t.message.replace(", lstat",""),new l(t)}}}export{x as ExternalResolver};
