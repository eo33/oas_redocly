import{pathToFileURL as d}from"url";import{slash as l}from"../../../../shared/utils.js";import{compose as m}from"./hono-compose.js";import{isDefined as s}from"../../../../shared/jsUtils.js";function D(e){return async(i,a)=>{await e.waitForPluginsLifecycle();const o=await w(e.serverOutDir),n=(await Promise.all(e.getAllMiddleware().map(({id:t})=>o[t]).map(async t=>typeof t=="function"?(await t()).default:void 0))).filter(s),r=await m(n)(i,a,e);if(!r.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return r.res}}async function w(e){let i;return process.env.REDOCLY_STATIC_BUNDLE?i=await import("@portal/middleware"):i=await import(d(`${l(e)}/middleware-entry.js`)+"?"+new Date),i.middleware}export{D as dynamicMiddleware};
