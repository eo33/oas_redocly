import{generateTemplatesModule as o}from"../esbuild/generate.js";import{getBilledPagesCount as p,logger as r,reporter as u}from"../utils/index.js";function g(e,t){e.on("routes-updated",()=>{t.broadcast({type:"routes-updated"}),r.verbose('Broadcast "routes-updated" over web-socket')}),e.on("template-updated",()=>{o(e)}),e.on("build-updated",()=>{t.unfreeze(),t.broadcast({type:"build-updated"})}),e.on("global-data-updated",d=>{t.broadcast({type:"global-data-updated",data:d})}),e.on("build-started",()=>{t.freeze()}),e.on("shared-data-updated",d=>{t.broadcast({type:"shared-data-updated",id:d})}),t.onConnect(d=>{d.send(JSON.stringify({type:"errors-updated",errors:u.getProblems()}));const a=p(e.getAllRoutes());a&&d.send(JSON.stringify({type:"pages-updated",pages:a}))}),e.on("errors-updated",d=>{t.broadcast({type:"errors-updated",errors:d})}),e.on("pages-updated",d=>{t.broadcast({type:"pages-updated",pages:d})})}export{g as listenStore};
