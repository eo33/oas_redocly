import{ServerRoutes as i}from"../../../shared/constants.js";import{withPathPrefix as e}from"../../../shared/urls.js";import{authMiddleware as A}from"../middleware/authMiddleware.js";import{ensureSearchData as L}from"../middleware/ensureSearchData.js";import{dynamicMiddleware as f}from"../middleware/dynamic-middleware/dynamic-middleware.js";import{installRoutes as _}from"../../plugins/dev-onboarding/api/routes/index.js";import{authorizeHandler as R,oidcCallbackHandler as H,logoutHandler as o,idpLoginHandler as c,redoclyLoginCallbackHandler as T,samlCallbackHandler as O,redoclyTokenLoginHandler as g}from"./auth.js";import{appDataHandler as C}from"./app-data.js";import{searchFacetsHandler as S,searchHandler as D}from"./search.js";import{dynamicRouteHandler as P}from"./dynamic-route.js";import{pageDataHandler as h,sharedPageDataHandler as w}from"./page-data.js";import{pathPrefixRedirectHandler as B}from"./path-prefix-redirect.js";import{getRoutesByLineHandler as p,resolvePathHandler as E,resolveSlugHandler as s}from"./resolve-route.js";import{feedbackHandler as U}from"./feedback.js";import{loggerMiddleware as I}from"../middleware/loggerMiddleware.js";import{responseHeadersMiddleware as M}from"../middleware/responseHeadersMiddleware.js";import{idleTimeoutMiddleware as y}from"../middleware/idleTimeoutMiddleware.js";import{telemetryHandler as G}from"./telemetry.js";import{otelTracesHandler as Y}from"./otel/otel.js";import{TELEMETRY_ENABLED as K}from"../../constants.js";import{healthCheckHandler as k}from"./health.js";import{askAiHandler as N}from"./ask-ai.js";import{replayOauth2RedirectCallbackHandler as v}from"./replay-oauth2-redirect.js";import{corsMiddleware as F}from"../middleware/corsMiddleware.js";function ra(a,l,n){const{resolveRouteData:t,readStaticAsset:r}=n;a.use("*",y()),a.use("*",f(l)),a.use("*",A(l)),a.use("*",I()),a.use("*",M(l)),a.use(e(i.FEEDBACK),F({allowMethods:["POST"]})),a.use("*",b(l));const d=L(l);a.get(e(i.SHARED_PAGE_DATA),w(l)),a.get(e(i.PAGE_DATA),h(l,t)),a.get(e(i.APP_DATA),C(l)),a.post(e(i.SEARCH),d,D(l)),a.post(e(i.SEARCH_FACETS),d,S(l)),a.post(e(i.AUTHORIZATION),R),a.post(e(i.LOGOUT),o(l)),a.get(e(i.LOGOUT),o(l)),a.get(e(i.OIDC_CALLBACK),H(l)),a.get(e(i.REDOCLY_TOKEN_LOGIN),g(l)),a.get(e(i.REDOCLY_LOGIN_CALLBACK),T()),a.get(e(i.IDP_LOGIN),c(l)),a.post(e(i.SAML_CALLBACK),O(l)),a.get(e(i.HEALTH),k),_(a,l),a.post(e(i.FEEDBACK),U),a.post(e(i.RESOLVE_ROUTE_BY_PATH),E(l)),a.post(e(i.RESOLVE_ROUTE_BY_SLUG),s(l)),a.post(e(i.ASK_AI),N),a.get(e(i.GET_ROUTES_BY_LINE),p(l)),K&&a.post(e(i.TELEMETRY),G),a.post(e(i.OTEL_TRACES),Y),a.get(e(i.REPLAY_OAUTH2_CALLBACK),v),a.all(e("/*"),P(l,t,r)),a.get("*",B),a.onError(m=>m instanceof Error&&"name"in m&&m.name==="URIError"?new Response("Malformed URL",{status:400}):new Response("Internal Server Error",{status:500}))}function b(a){return async(l,n)=>{await a.waitForPluginsLifecycle(),await n()}}function Aa(a,l){a.post(e(i.RESOLVE_ROUTE_BY_PATH),E(l)),a.post(e(i.RESOLVE_ROUTE_BY_SLUG),s(l)),a.get(e(i.GET_ROUTES_BY_LINE),p(l))}export{Aa as installDevRoutes,ra as installProdRoutes,b as waitForPluginsLifecycle};
