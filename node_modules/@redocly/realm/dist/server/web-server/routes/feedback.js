import{FEEDBACK_API_URL as f}from"../../constants.js";import{mapObject as l}from"../../../shared/jsUtils.js";function u(e){if(!e)return e;const n=["userAgent","firstName","lastName","auth_time","platform","id"];return l(e,(o,t)=>n.includes(t)?o:"*****")}function h({component:e,path:n,location:o,lang:t,score:s,max:a,reasons:r,comment:i,metadata:c}){return{feedbackComponent:e.toUpperCase(),path:n,location:o,lang:t,score:s,maxScore:a,reasons:r,comment:i,metadata:u(c)}}async function b(e,n){return(await fetch(f,{method:"POST",body:JSON.stringify(h(e)),headers:n})).json()}async function y(e){const n=await e.req.json(),o=e.req.header("user-agent"),t=e.req.header("Sec-Ch-Ua-Platform"),s={...n.metadata,userAgent:o,platform:t?t.replace(/"/g,""):"unknown"},a=[];(!n.path||n.path==="")&&a.push("`path` is required");const r=["sentiment","rating","comment","problem","mood","scale"];if(r.includes(n.component)||a.push(`\`component\` field should be one of ${r.join(", ")}.`),a.length)return e.json({errors:a},400);const{claims:i={email:void 0}}=e.get("auth"),{email:c,...d}=i,m={"Content-Type":"application/json"},p=await b({...n,email:c,metadata:{...s,...d}},m);return e.json({message:"Thanks for your feedback",...p},200,{})}export{y as feedbackHandler,u as normalizeFeedbackMetadata};
