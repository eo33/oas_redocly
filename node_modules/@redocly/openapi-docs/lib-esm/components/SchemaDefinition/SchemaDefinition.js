import{jsx as _jsx,jsxs as _jsxs}from"react/jsx-runtime";import{memo,useCallback,useMemo}from"react";import styled from"styled-components";import{LayoutVariant}from"@redocly/theme";import{useAtom,useAtomValue}from"jotai";import{writeAtom}from"../../jotai/nexus";import{SamplesMiddlePanel,SamplesPanel,Row,Section,CodeBlockPanel}from"../common";import{getMediaType}from"../../models";import{MediaTypeSamples}from"../PayloadSamples";import{Schema}from"../Schema";import{Markdown}from"../Markdown";import{layoutAtom}from"../../jotai/app";import{globalStoreAtom}from"../../jotai/store";import{operationStore}from"../../jotai/operation";const getMediaTypeInfo=(e,o)=>{if(!e)return{};const a={schema:{$ref:e}};return o&&(a.examples={example:{$ref:o}}),a};function SchemaDefinitionComponent({schemaRef:e,exampleRef:o,showReadOnly:a=!0,showWriteOnly:t=!1}){var i,n,m;const s=useAtomValue(layoutAtom),{parser:r,options:l}=useAtomValue(globalStoreAtom),p=useMemo((()=>getMediaType(r,"json",!1,getMediaTypeInfo(e,o),l,{operation:{pointer:"SchemaDefinitionComponent"}})),[o,l,r,e]),[c,d]=useAtom(operationStore(null===(i=p.operation)||void 0===i?void 0:i.pointer)),u=useCallback((e=>{if(!p.schema)return;const o=p.schema,a=o.oneOf;if(a&&(null==p?void 0:p.examples)&&Object.keys(null==p?void 0:p.examples).includes(e)){const t=a.findIndex((o=>o.title===e));-1!==t&&o&&writeAtom(operationStore(o.operationPointer),(e=>{var a,i;return Object.assign(Object.assign({},e),{activeExampleName:(null===(i=null===(a=o.oneOf)||void 0===a?void 0:a[t])||void 0===i?void 0:i.title)||e.activeExampleName,activeOneOf:Object.assign(Object.assign({},e.activeOneOf),{[o.pointer]:t})})}))}c.activeExampleName!==e&&d((o=>Object.assign(Object.assign({},o),{activeExampleName:e})))}),[null==p?void 0:p.examples,p.schema,c.activeExampleName,d]),f=s===LayoutVariant.STACKED;return _jsx(Section,{children:_jsxs(Row,{layout:s,children:[_jsxs(SamplesMiddlePanel,{isStacked:f,children:[(null===(n=p.schema)||void 0===n?void 0:n.description)&&_jsx(Description,{children:_jsx(Markdown,{source:null===(m=p.schema)||void 0===m?void 0:m.description})}),_jsx(Schema,{skipWriteOnly:!t,skipReadOnly:!a,schema:p.schema,level:1})]}),_jsx(SamplesPanel,{isStacked:f,children:_jsx(CodeBlockPanel,{className:"panel-response-samples",children:_jsx(MediaTypeSamples,{mediaType:p,onChange:u})})})]})})}export const SchemaDefinition=memo(SchemaDefinitionComponent);const Description=styled.div`
  margin-bottom: var(--spacing-vertical);
`;
//# sourceMappingURL=SchemaDefinition.js.map