import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from"react/jsx-runtime";import{memo,useState,useCallback,useMemo}from"react";import{useLocation}from"react-router-dom";import styled from"styled-components";import{useAtomValue}from"jotai";import{Feedback,LayoutVariant,BeforeOpenApiOperation,AfterOpenApiOperation,IS_BROWSER}from"@redocly/theme";import{SamplesMiddlePanel,SamplesPanel,ShareLink,Row,CustomBadges}from"../common";import{CallbacksList}from"../Callbacks";import{CallbackSamples}from"../CallbackSamples";import{RequestSamples}from"../RequestSamples";import{OperationResponseList}from"../Responses";import{ResponseSamples}from"../ResponseSamples";import{makeDeepLink,joinWithSeparator}from"../../services";import{layoutAtom}from"../../jotai/app";import{globalStoreAtom}from"../../jotai/store";import{getOperation}from"../../models/operation";import{RenderHook}from"../RenderHook";import{Heading,Title}from"../common/OperationItemTitle";import{LinkToField}from"../common/LinkToField";import{RequestDetails}from"../Request/RequestDetails";import{StyledBadge}from"../common/Badges";import{useTranslate,useIsContentVisible}from"../../hooks";import{pathIncludesLink}from"../../utils";function OperationItemComponent({item:{operationDefinition:e,parent:a,href:o}}){var t,s;const i=useLocation(),l=useMemo((()=>!IS_BROWSER||"undefined"!=typeof window||pathIncludesLink(i,e.operationId)),[i,e.operationId]),{isVisible:n,targetRef:r}=useIsContentVisible({defaultVisible:l}),p=useTranslate(),{parser:d,options:m}=useAtomValue(globalStoreAtom),c=useAtomValue(layoutAtom),[u,k]=useState(),{unstable_hooks:S,feedback:b}=m,h=useMemo((()=>getOperation(d,e,a,m,o,void 0,n)),[o,n,e,m,a,d]),{name:x,deprecated:f,isWebhook:j,badges:g}=h||{},_=c===LayoutVariant.STACKED,R=(null==b?void 0:b.type)||"sentiment",O=!0!==(null==b?void 0:b.hide),[y,v]=useState(null),C=useCallback((e=>{u!==e&&k(e)}),[u]),w=useMemo((()=>O?_jsx(FeedbackWrapper,{children:_jsx(Feedback,{type:R,settings:b.settings,path:joinWithSeparator(m.routingBasePath,h.href)})}):null),[O,R,b.settings,m.routingBasePath,h.href]);return _jsxs(OperationRow,{layout:c,ref:r,children:[_jsx(OperationSubRowStyled,{layout:c,children:_jsxs(SamplesMiddlePanel,{isStacked:_,children:[_jsx(RenderHook,{Hook:BeforeOpenApiOperation||(null==S?void 0:S.BeforeOperation),props:{operation:h}}),_jsxs(Heading,{"data-testid":"operation-item-header",children:[_jsx(ShareLink,{to:o,"aria-label":`link to ${x}`}),_jsx(CustomBadges,{badges:g,children:x}),f&&_jsx(StyledBadge,{deprecated:!0,children:p("openapi.badges.deprecated","Deprecated")}),j&&_jsx(StyledBadge,{children:p("openapi.badges.webhook","Webhook")})]})]})}),_jsxs(OperationSubRowStyled,{layout:c,children:[_jsx(SamplesMiddlePanel,{isStacked:_,children:_jsx(RequestDetails,{operation:h,translate:p})}),n&&_jsx(OperationSamplesPanel,{isStacked:_,"data-testid":"samples-block",className:"panel-container-request-samples",children:_jsx(RequestSamples,{operation:h})})]}),_jsxs(OperationSubRowStyled,{layout:c,children:[_jsx(SamplesMiddlePanel,{isStacked:_,children:(null===(t=h.responses)||void 0===t?void 0:t.length)?_jsx(OperationResponseList,{responses:h.responses,operationId:h.id,operationPointer:h.pointer,callbackId:h.callbackId,activeResponseTab:u,onTabChange:C}):null}),n&&_jsx(OperationSamplesPanel,{isStacked:_,"data-testid":"samples-block",className:"panel-container-response-samples",children:_jsx(ResponseSamples,{operation:h,activeResponseTab:u,onTabChange:C})})]}),_jsxs(OperationSubRowStyled,{layout:c,children:[_jsxs(SamplesMiddlePanel,{isStacked:_,children:[(null===(s=h.callbacks)||void 0===s?void 0:s.length)?_jsxs(_Fragment,{children:[_jsxs(Title,{children:[_jsx(LinkToField,{to:makeDeepLink(h.id,"callbacks")}),p("openapi.callbacks","Callbacks")]}),_jsx(CallbacksList,{callbacks:h.callbacks,onExpand:v,selectedCallback:y})]}):null,_jsx(RenderHook,{Hook:AfterOpenApiOperation||(null==S?void 0:S.AfterOperation),props:{operation:h}})]}),y?_jsx(OperationSamplesPanel,{isStacked:_,"data-testid":"samples-block",children:_jsx(CallbackSamples,{callback:y,translate:p})}):null]}),_jsx(OperationSubRowStyled,{layout:c,children:_jsx(SamplesMiddlePanel,{isStacked:_,fullWidth:!0,children:w})})]})}export const OperationItem=memo(OperationItemComponent);const OperationSamplesPanel=styled(SamplesPanel)`
  margin-left: auto;
  --code-block-padding: var(--spacing-xs) 0 var(--spacing-xs) 20px;
`,FeedbackWrapper=styled.div`
  & > div {
    flex: 1 1 auto;
    display: flex;
    justify-content: center;
  }

  & > div > div {
    width: 100%;
    max-width: var(--feedback-width);
  }
`,OperationRow=styled(Row)`
  flex-direction: column;
  align-items: flex-start;
  padding: var(--spacing-base) 0 calc(var(--spacing-xl) + var(--spacing-xs));
`,OperationSubRowStyled=styled(Row)`
  margin: calc(var(--spacing-unit) * 2) 0;
`;
//# sourceMappingURL=OperationItem.js.map