import{CodeBuilder}from"../../helpers/code-builder";import{buildUrlExpression,printUrlVariablesDeclarations}from"../../helpers/code-helpers";import{Lang}from"../../helpers/constants";import{HTTPSnippet}from"../..";import{normalizeMimeType}from"../../../../utils";import{MediaTypes}from"../../../../../constants";import{postDataToRListBody,objectToRString}from"./utils";const indent=1,handler=function(e,a,{target:t,client:s}){var o,r,i,n;const l=Object.assign({indent:"  ",showBoilerplate:!0,printBody:!0},a),p=new CodeBuilder({indentation:l.indent,variablesPrefix:l.variablesPrefix,lang:Lang.R}),d=e.method.toUpperCase(),c=null===(o=e.securityOAuth2ExtraCalls)||void 0===o?void 0:o[0];if(l.showBoilerplate&&p.push("library(httr)").blank(),c){const a="oauth2_",o=new HTTPSnippet(c).convert(t,s,Object.assign(Object.assign({},l),{variablesPrefix:a,showBoilerplate:!1})),r=`${a}data_req`;p.push(o).push(`access_token = content(${r}, "parsed")$access_token`).blank(),e.allHeaders.Authorization='paste("Bearer", access_token)'}let u,b="";if(null==e?void 0:e.postData)switch(normalizeMimeType(null===(r=null==e?void 0:e.postData)||void 0===r?void 0:r.mimeType)){case MediaTypes.URL_ENCODED:{u="form",b=p.var("body");const a=postDataToRListBody(e.postData.params,l);p.push(`${b} <- list(${a})`).blank();break}case MediaTypes.JSON:{u="json",b=p.var("body");const a=objectToRString(e.postData.jsonObj,l);p.push(`${b} = '${a}'`).blank();break}case MediaTypes.MULTIPART:{u="multipart",b=p.var("body");const a=postDataToRListBody(e.postData.params,l);p.push(`${b} <- list(${a})`).blank();break}default:(null===(i=e.postData)||void 0===i?void 0:i.text)&&(b=p.var("body"),u="raw",p.push(`${b} = ${objectToRString(null===(n=e.postData)||void 0===n?void 0:n.text)}`).blank())}printUrlVariablesDeclarations(e,p),Object.keys(Object.assign(Object.assign({},e.pathParameters),e.serverVariables)).length&&p.blank().push("# create you own operator").push('"%&%" <- function(x, y)paste0(x,y)').blank();const h=buildUrlExpression(e,p);p.push(`url = ${h}`).blank();const m=p.var("data_req");if(p.push(`${m} <- ${d}(`),p.push(1,"url,"),e.basicAuth){const{username:a,password:t}=e.basicAuth;p.push(1,`authenticate("${a}", "${t}")`)}if(Object.keys(e.allHeaders).length){const a=`${Object.keys(e.allHeaders).map((a=>`"${a}" = ${e.allHeaders[a].startsWith("paste")?e.allHeaders[a]:`"${e.allHeaders[a]}"`}`)).join(", ")}`;a&&p.push(1,`add_headers(${a}),`)}return b&&(p.push(1,`body = ${b},`),p.push(1,`encode = "${u}",`)),p.push(1,"verbose()"),p.push(")"),l.printBody&&p.blank().push(`content(${m}${"raw"===u?', "text"':""})`),p.join()};export default handler;
//# sourceMappingURL=httr.js.map