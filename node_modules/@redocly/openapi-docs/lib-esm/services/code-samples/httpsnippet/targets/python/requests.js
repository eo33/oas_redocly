import{format}from"util";import{CodeBuilder}from"../../helpers/code-builder";import{normalizeMimeType}from"../../../../utils";import{addIndentation,buildUrlExpression,printUrlVariablesDeclarations}from"../../helpers/code-helpers";import{HTTPSnippet}from"../..";import{Lang}from"../../helpers/constants";import{MediaTypes}from"../../../../../constants";const handler=function(e,t,{target:a,client:s}){var o,r,n,i;const l=Object.assign({indent:"  "},t),{level:p=0}=l,u=new CodeBuilder({indentation:l.indent,variablesPrefix:l.variablesPrefix,lang:Lang.PYTHON});l.withComments&&addComments(u),l.withImports&&u.push("import requests").blank();let d,h,c,m=!1,b=e.allHeaders;if(null===(o=e.securityOAuth2ExtraCalls)||void 0===o?void 0:o.length){const t=new HTTPSnippet(null===(r=e.securityOAuth2ExtraCalls)||void 0===r?void 0:r[0]).convert(a,s,Object.assign(Object.assign({},l),{withImports:!1,withComments:!1,variablesPrefix:"oauth2_"}));u.push(t),u.blank(),b=b||{},b.Authorization='"Bearer " + oauth2_data["access_token"]',m=!0}if(printUrlVariablesDeclarations(e,u),u.push(`${u.var("url").toLowerCase()} = %s`,buildUrlExpression(e,u)).blank(),Object.keys(e.queryObj||{}).length){d="query = "+jsObjectToPythonDict(e.queryObj,l.indent),u.push(d).blank()}const f=normalizeMimeType(null===(n=e.postData)||void 0===n?void 0:n.mimeType);if(e.postData)switch(f){case MediaTypes.URL_ENCODED:h=e.postData.paramsObj?`${addIndentation(jsObjectToPythonDict(e.postData.paramsObj,l.indent),{level:0,firstLine:!1})}`:e.postData.text;break;case MediaTypes.JSON:e.postData.jsonObj&&(h=addIndentation(jsObjectToPythonDict(e.postData.jsonObj,l.indent),{level:0,firstLine:!1}));break;case MediaTypes.MULTIPART:const t=[];if(e.postData.params)for(const a of e.postData.params)t.push(`"${a.name}": "${a.value}"`);if(t.length){c=`data = {\n${t.map((e=>`  ${e}`)).join(",\n")}\n}`}c&&u.push(c).blank();break;default:e.postData.text&&(h=`'''\n${addIndentation(e.postData.text.trim(),{level:1,indent:l.indent,firstLine:!0})}\n'''`)}let v;h&&u.push(`${u.var("payload").toLowerCase()} = %s`,h).blank();const $=Object.keys(b).length,C=(e,t)=>"Authorization"===e&&m?t:`"${t}"`;if(1===$)for(v in b)u.push(`${u.var("headers").toLowerCase()} = {"${v}": ${C(v,b[v])}}`).blank();else if($>1){let e=1;for(v in u.push(`${u.var("headers").toLowerCase()} = {`),b)e++!==$?u.push(1,`"${v}": ${C(v,b[v])},`):u.push(1,`"${v}": ${C(v,b[v])}`);u.push(0,"}").blank()}const L=e.method.toLowerCase();let j=format(`${u.var("response").toLowerCase()} = requests.${L}(${u.var("url").toLowerCase()}`);if(f===MediaTypes.MULTIPART&&c&&(j+=", data=data"),h){j+=`, ${f===MediaTypes.JSON?"json":"data"}=${u.var("payload").toLowerCase()}`}return $>0&&(j+=`, headers=${u.var("headers").toLowerCase()}`),d&&(j+=`, params=${u.var("query").toLowerCase()}`),e.basicAuth&&(j+=`, auth=('${e.basicAuth.username}','${e.basicAuth.password}')`),j+=")",u.push(j).blank(),(null===(i=e.allResponseCodes)||void 0===i?void 0:i.includes("204"))?u.push("if response.status_code == 204:").push(p+1,'print("success")').push("else:").push(p+1,`${u.var("data").toLowerCase()} = ${u.var("response").toLowerCase()}.json()`).push(p+1,`print(${u.var("data").toLowerCase()})`):u.push(`${u.var("data").toLowerCase()} = ${u.var("response").toLowerCase()}.json()`).push(`print(${u.var("data").toLowerCase()})`),u.join()};export default handler;function addComments(e){e.push('"""'),e.push("Requires python >= 3"),e.blank(),e.push('Requires module "requests" >= 2.25.1'),e.push("See here for installation details:"),e.push("  https://requests.readthedocs.io/"),e.push('"""'),e.blank()}function jsObjectToPythonDict(e,t){return JSON.stringify(e,(function(e,t){return e&&"boolean"==typeof t?t?"__REDOCLY_<True>__":"__REDOCLY_<False>__":null===t?"__REDOCLY_<None>__":t}),t).replace(/"__REDOCLY_<(\w+)>__"/g,"$1")}
//# sourceMappingURL=requests.js.map