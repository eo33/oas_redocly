import{CodeBuilder}from"../../helpers/code-builder";import{HTTPSnippet}from"../../index";import{isEmptyObject,normalizeMimeType}from"../../../../utils";import{capitalizeFirst}from"../../../generator";import{Lang}from"../../helpers/constants";import{buildUrlExpression,printUrlVariablesDeclarations}from"../../helpers/code-helpers";import{MediaTypes}from"../../../../../constants";const handler=function(t,e,{target:s,client:a}){var i,r;const p=Object.assign({indent:"  ",withWrapper:!0},e),n=new CodeBuilder({indentation:p.indent,variablesPrefix:p.variablesPrefix,capitalize:!0,lang:Lang.JAVA8}),o=formatHttpMethod(t.method);if(p.withComments&&addComments(n),p.withImports&&addImports(n,t),p.withWrapper&&(n.push("public class App {"),n.push(1,"public static void main(String[] args ) throws java.io.IOException {"),n.push(2,"HttpClient httpClient = HttpClientBuilder.create().build();"),n.blank()),null===(i=t.securityOAuth2ExtraCalls)||void 0===i?void 0:i.length){const e=new HTTPSnippet(null===(r=t.securityOAuth2ExtraCalls)||void 0===r?void 0:r[0]).convert(s,a,Object.assign(Object.assign({},p),{withImports:!1,withWrapper:!1,withComments:!1,variablesPrefix:"oauth2"}));n.push(e),n.push(2,"JSONObject %s = new JSONObject(EntityUtils.toString(httpClient.execute(%s).getEntity()));","oauth2Response","oauth2Request"),n.push(2,'String accessToken = %s.getString("access_token");',"oauth2Response"),n.blank()}printUrlVariablesDeclarations(t,n,2);const u=buildUrlExpression(t,n);n.push(2,`%s ${n.var("request")} = new %s(%s);`,o,o,u);const h=Object.keys(t.allHeaders);if(!h.length||t.postData&&t.postData.mimeType==MediaTypes.MULTIPART||h.forEach((e=>{var s;n.push(2,'%s.setHeader("%s", %s);',n.var("request"),e,(null===(s=t.securityOAuth2ExtraCalls)||void 0===s?void 0:s.length)?'"Bearer " + accessToken':`"${t.allHeaders[e]}"`)})),t.basicAuth){const{username:e,password:s}=t.basicAuth;n.push(2,`String encodedString = Base64.getEncoder().encodeToString("${e}:${s}".getBytes());`),n.push(2,'%s.setHeader("%s", "%s"+encodedString);',n.var("request"),"Authorization","Basic ")}if(t.postData)switch(normalizeMimeType(t.postData.mimeType)){case MediaTypes.URL_ENCODED:t.postData.params&&(n.blank(),n.push(2,"List<NameValuePair> params = new ArrayList<NameValuePair>();"),t.postData.params.forEach((t=>{n.push(2,'params.add(new BasicNameValuePair("%s", "%s"));',t.name,t.value)})),n.push(2,"%s.setEntity(new UrlEncodedFormEntity(params));",n.var("request")),n.blank());break;case MediaTypes.MULTIPART:t.postData.params&&(n.push(2,"MultipartEntity reqEntity = new MultipartEntity();"),t.postData.params.forEach((t=>{n.push(2,'reqEntity.addPart("%s", %s);',t.name,isString(t.value)?`new StringBody("${t.value}")`:t.value)})),n.push(2,"%s.setEntity(reqEntity);",n.var("request")));break;case MediaTypes.JSON:if(t.postData.jsonObj){n.push(2,"JSONObject payload = new JSONObject();");for(const[e,s]of Object.entries(t.postData.jsonObj))Array.isArray(s)?(n.push(2,'payload.put("%s", new JSONArray()',e),s.forEach((t=>{isObject(t)?(n.push(3,".put(new JSONObject()"),l(t,4),n.push(3,")")):n.push(3,".put(%s)",formatValue(t))})),n.push(2,");")):isObject(s)?(n.push(2,'payload.put("%s", new JSONObject()%s',e,isEmptyObject(s)?");":""),l(s,3),isEmptyObject(s)||n.push(2,");")):n.push(2,'payload.put("%s", %s);',e,formatValue(s));n.push(2,"%s.setEntity(new StringEntity(payload.toString()));",n.var("request"))}break;case MediaTypes.XML:t.postData.text&&(n.push(2,'String payload = String.join("\\n"'),t.postData.text.trim().split("\n").forEach((t=>{const e=t.replace(/"/g,'\\"');n.push(3,`"${e}", `)})),n.push(2,");"),n.push(2,"%s.setEntity(new StringEntity(payload));",n.var("request")))}return p.withWrapper&&(n.push(2,`String ${n.var("response")} = EntityUtils.toString(httpClient.execute(request).getEntity());`),n.blank(),n.push(2,"System.out.println(response);"),n.push(1,"}"),n.push("}")),n.join();function l(t,e){for(const[s,a]of Object.entries(t))isObject(a)?(n.push(e,'.put("%s", new JSONObject()',s),l(a,e+1),n.push(e,")")):n.push(e,'.put("%s", %s)',s,formatValue(a))}};export const info={key:"apachehttp",title:"Apache http",link:"https://hc.apache.org/httpcomponents-client-4.5.x/",description:"Apache HttpClient"};export default handler;function addComments(t){t.push("/**"),t.push(" * Requires JDK >= 8"),t.push(" *"),t.push(" * Requires Apache HttpComponents Client >= 4.3.5"),t.push(" * See here for installation details:"),t.push(" *   https://search.maven.org/artifact/org.apache.httpcomponents/httpcomponents-client"),t.push(" *"),t.push(' * Requires package "junit4"'),t.push(" * See here for installation details:"),t.push(" *   https://junit.org/junit4"),t.push(" *"),t.push(' * Requires package "org.json" >= 20180130'),t.push(" * See here for installation details:"),t.push(" *   https://search.maven.org/artifact/org.json/json"),t.push(" */"),t.blank()}function addImports(t,e){var s,a,i;t.push("import org.apache.http.util.EntityUtils;"),t.push("import org.apache.http.NameValuePair;"),t.push("import org.apache.http.client.HttpClient;"),t.push("import org.apache.http.client.entity.UrlEncodedFormEntity;"),e.method&&addHttpMethodImport(t,e.method),(null===(s=e.securityOAuth2ExtraCalls)||void 0===s?void 0:s.length)&&(null===(a=e.securityOAuth2ExtraCalls)||void 0===a?void 0:a[0].method.toLowerCase())!==e.method.toLowerCase()&&addHttpMethodImport(t,null===(i=e.securityOAuth2ExtraCalls)||void 0===i?void 0:i[0].method),t.push("import org.apache.http.impl.client.HttpClientBuilder;"),t.push("import org.apache.http.message.BasicNameValuePair;"),t.push("import org.apache.http.entity.StringEntity;"),t.push("import org.json.JSONObject;"),t.push("import org.json.JSONArray;"),t.push("import java.util.ArrayList;"),t.push("import java.util.List;"),t.push("import org.apache.http.entity.mime.MultipartEntity;"),t.push("import org.apache.http.entity.mime.content.StringBody;"),e.basicAuth&&t.push("import java.util.Base64;"),t.blank()}function addHttpMethodImport(t,e){const s=formatHttpMethod(e);t.push(`import org.apache.http.client.methods.${s};`)}function formatHttpMethod(t){return"Http"+capitalizeFirst(t.toLowerCase())}function isString(t){return"[object String]"===Object.prototype.toString.call(t)}function isObject(t){const e=typeof t;return"function"===e||"object"===e&&!!t}function formatValue(t){return isString(t)?JSON.stringify(t):null==t?"JSONObject.NULL":t}
//# sourceMappingURL=apachehttp.js.map