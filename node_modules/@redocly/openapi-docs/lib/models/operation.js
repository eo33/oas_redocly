"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isPayloadSample=isPayloadSample,exports.getOperation=getOperation,exports.mergeInMockServer=mergeInMockServer;const theme_1=require("@redocly/theme"),config_1=require("@redocly/config"),utils_1=require("../utils"),callback_1=require("./callback"),field_1=require("./field"),request_1=require("./request"),security_1=require("./security"),response_1=require("./response"),operation_1=require("../services/menu/operation");function isPayloadSample(e){return"Payload"===e.lang&&"requestBodyContent"in e}function getOperation(e,r,t,i,o,s,n=!0){var a,l;const u=r.isWebhook,p={operationDefinition:r,parent:t,pointer:r.pointer,description:n?(0,utils_1.getValueFromMdParsedExtension)(r,"description"):"",externalDocs:r.externalDocs,deprecated:!!r.deprecated,httpVerb:r.httpVerb,operationId:r.operationId,path:r.pathName,isWebhook:u,isCallback:Boolean(null==s?void 0:s.isCallback),isEvent:(null==s?void 0:s.isCallback)||u,name:(0,utils_1.getOperationName)(r),defaultExampleName:r.defaultSampleName,[config_1.REDOCLY_TEAMS_RBAC]:r[config_1.REDOCLY_TEAMS_RBAC]||(null==t?void 0:t[config_1.REDOCLY_TEAMS_RBAC]),type:"operation",callbackId:null==s?void 0:s.id,href:o,get callbacks(){return n?Object.keys(r.callbacks||[]).map((s=>{var n;return(0,callback_1.getCallback)(e,s,null===(n=r.callbacks)||void 0===n?void 0:n[s],p.pointer,i,o,t)})):[]},get responses(){let t=!1;return n?Object.keys(r.responses||[]).filter((e=>"default"===e||("success"===(0,utils_1.getStatusCodeType)(e)&&(t=!0),(0,utils_1.isStatusCode)(e)))).map((o=>(0,response_1.getResponse)({parser:e,code:o,defaultAsError:t,infoOrRef:r.responses[o],options:i,isEvent:p.isEvent,operation:p}))):[]},get parameters(){if(!n)return[];let t=(0,utils_1.mergeParams)(e,r.pathParameters,r.parameters,{pathPointer:utils_1.JsonPointer.dirName(p.pointer),operationPointer:p.pointer}).map((({paramOrRef:r,pointer:t})=>(0,field_1.getField)(e,r,t,i,{operation:p,type:"request"})));return i.sortRequiredPropsFirst&&(t=(0,utils_1.sortByRequired)(t)),(0,utils_1.sortByDeprecated)(t)}};(null==s?void 0:s.isCallback)?(p.security=(0,security_1.getSecurity)(r.security,e),p.servers=(0,utils_1.normalizeServers)("",r.servers||r.pathServers||[]),p.id=(0,theme_1.removeLeadingSlash)(o)):(p.id=(0,utils_1.getOperationId)(r,t),p.href=p.href||(0,operation_1.getHref)(p),p.security=n?(0,security_1.getSecurity)(r.security||e.definition.security,e):[],p.servers=n?(0,utils_1.normalizeServers)(e.definitionUrl,mergeInMockServer(r.servers||r.pathServers||e.definition.servers||[],i.mockServer)):[]),i.showExtensions&&(p.extensions=(0,utils_1.extractExtensions)(r,i.showExtensions)),p.requestBody=n&&r.requestBody?(0,request_1.getRequestBody)({parser:e,infoOrRef:r.requestBody,options:i,operation:p,isEvent:p.isEvent}):void 0;const c=null===(a=p.requestBody)||void 0===a?void 0:a.content;return p.payload={lang:"Payload",source:"",requestBodyContent:(null==c?void 0:c.hasSample)?c:void 0},p.definitionSamples=r["x-codeSamples"]||[],p.badges=(null===(l=r["x-badges"])||void 0===l?void 0:l.map((({name:e,color:r,position:t})=>({name:e,color:r||"var(--color-info-base)",position:t||"after"}))))||[],p.hasSamples=(null==c?void 0:c.hasSample)||p.definitionSamples.length>0,p.hideReplay=!0===r["x-hideReplay"],p}function mergeInMockServer(e,r){if(!r)return e;const t={url:r.url,description:r.description};switch(r.position){case"first":return[t,...e];case"last":return[...e,t];case"replace":return[t];default:return e}}
//# sourceMappingURL=operation.js.map