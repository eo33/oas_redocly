"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getField=getField;const config_1=require("@redocly/config"),services_1=require("../services"),utils_1=require("../utils"),schema_1=require("./schema"),example_1=require("./example"),DEFAULT_SERIALIZATION={path:{style:"simple",explode:!1},query:{style:"form",explode:!0},header:{style:"simple",explode:!1},cookie:{style:"form",explode:!0}};function getField(e,i,s,o,t,l,n=s){var d,r,a,c,p,m,u;const{resolved:x}=e.deref(i),v=i.kind||"field",_=i.name||x.name,f=x.in,h=!!x.required;let g,E,A=x.schema,O="";if(!A&&x.in&&x.content){O=Object.keys(x.content)[0];const i=x.content[O];A=i&&(null==i?void 0:i.example)?Object.assign(Object.assign({},e.deref(i.schema,l,!0).resolved),{example:x.example||i.example}):i.schema}const F=(0,services_1.joinWithSeparator)(t.parentFieldFullPath,(0,utils_1.removePercentChart)(_||"")),y=(0,schema_1.getSchema)({parser:e,schemaOrRef:A||{},pointer:s,options:o,baseRefsStack:l,absolutePointer:i.$ref||(null===(d=x.schema)||void 0===d?void 0:d.absolutePointer)||n,deps:Object.assign(Object.assign({},t),{parentFieldFullPath:F,in:f})}),R=void 0===x.description?(0,utils_1.getValueFromMdParsedExtension)(y,"description")||"":(0,utils_1.getValueFromMdParsedExtension)(x,"description"),b=x.example||y.example,I=x.examples||(null===(a=null===(r=x.content)||void 0===r?void 0:r[O])||void 0===a?void 0:a.examples),L=I?(0,utils_1.mapValues)(I,((i,s)=>(0,example_1.getExamples)({parser:e,infoOrRef:i,mime:s,encoding:x.encoding}))):void 0;O?g=O:x.style?E=x.style:f&&(E=null!==(p=null===(c=DEFAULT_SERIALIZATION[f])||void 0===c?void 0:c.style)&&void 0!==p?p:"form");const P=void 0===x.explode&&f?null===(u=null===(m=DEFAULT_SERIALIZATION[f])||void 0===m?void 0:m.explode)||void 0===u||u:!!x.explode;return{deps:t||{},schema:y,name:_,required:h,description:R,example:b,examples:L,deprecated:void 0===x.deprecated?y.deprecated:x.deprecated,in:f,kind:v,extensions:o.showExtensions?(0,utils_1.extractExtensions)(x,o.showExtensions):void 0,explode:P,style:E,const:(null==y?void 0:y.const)||(null==x?void 0:x.const)||"",serializationMime:g,fieldFullPath:F,[config_1.REDOCLY_TEAMS_RBAC]:x[config_1.REDOCLY_TEAMS_RBAC]||y[config_1.REDOCLY_TEAMS_RBAC]}}
//# sourceMappingURL=field.js.map