"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.OperationItem=void 0;const jsx_runtime_1=require("react/jsx-runtime"),react_1=require("react"),react_router_dom_1=require("react-router-dom"),styled_components_1=__importDefault(require("styled-components")),jotai_1=require("jotai"),theme_1=require("@redocly/theme"),common_1=require("../common"),Callbacks_1=require("../Callbacks"),CallbackSamples_1=require("../CallbackSamples"),RequestSamples_1=require("../RequestSamples"),Responses_1=require("../Responses"),ResponseSamples_1=require("../ResponseSamples"),services_1=require("../../services"),app_1=require("../../jotai/app"),store_1=require("../../jotai/store"),operation_1=require("../../models/operation"),RenderHook_1=require("../RenderHook"),OperationItemTitle_1=require("../common/OperationItemTitle"),LinkToField_1=require("../common/LinkToField"),RequestDetails_1=require("../Request/RequestDetails"),Badges_1=require("../common/Badges"),hooks_1=require("../../hooks"),utils_1=require("../../utils");function OperationItemComponent({item:{operationDefinition:e,parent:t,href:s}}){var a,o;const i=(0,react_router_dom_1.useLocation)(),n=(0,react_1.useMemo)((()=>!theme_1.IS_BROWSER||"undefined"!=typeof window||(0,utils_1.pathIncludesLink)(i,e.operationId)),[i,e.operationId]),{isVisible:r,targetRef:l}=(0,hooks_1.useIsContentVisible)({defaultVisible:n}),_=(0,hooks_1.useTranslate)(),{parser:d,options:p}=(0,jotai_1.useAtomValue)(store_1.globalStoreAtom),m=(0,jotai_1.useAtomValue)(app_1.layoutAtom),[u,c]=(0,react_1.useState)(),{unstable_hooks:x,feedback:j}=p,k=(0,react_1.useMemo)((()=>(0,operation_1.getOperation)(d,e,t,p,s,void 0,r)),[s,r,e,p,t,d]),{name:h,deprecated:b,isWebhook:S,badges:R}=k||{},g=m===theme_1.LayoutVariant.STACKED,f=(null==j?void 0:j.type)||"sentiment",q=!0!==(null==j?void 0:j.hide),[v,O]=(0,react_1.useState)(null),y=(0,react_1.useCallback)((e=>{u!==e&&c(e)}),[u]),C=(0,react_1.useMemo)((()=>q?(0,jsx_runtime_1.jsx)(FeedbackWrapper,{children:(0,jsx_runtime_1.jsx)(theme_1.Feedback,{type:f,settings:j.settings,path:(0,services_1.joinWithSeparator)(p.routingBasePath,k.href)})}):null),[q,f,j.settings,p.routingBasePath,k.href]);return(0,jsx_runtime_1.jsxs)(OperationRow,{layout:m,ref:l,children:[(0,jsx_runtime_1.jsx)(OperationSubRowStyled,{layout:m,children:(0,jsx_runtime_1.jsxs)(common_1.SamplesMiddlePanel,{isStacked:g,children:[(0,jsx_runtime_1.jsx)(RenderHook_1.RenderHook,{Hook:theme_1.BeforeOpenApiOperation||(null==x?void 0:x.BeforeOperation),props:{operation:k}}),(0,jsx_runtime_1.jsxs)(OperationItemTitle_1.Heading,{"data-testid":"operation-item-header",children:[(0,jsx_runtime_1.jsx)(common_1.ShareLink,{to:s,"aria-label":`link to ${h}`}),(0,jsx_runtime_1.jsx)(common_1.CustomBadges,{badges:R,children:h}),b&&(0,jsx_runtime_1.jsx)(Badges_1.StyledBadge,{deprecated:!0,children:_("openapi.badges.deprecated","Deprecated")}),S&&(0,jsx_runtime_1.jsx)(Badges_1.StyledBadge,{children:_("openapi.badges.webhook","Webhook")})]})]})}),(0,jsx_runtime_1.jsxs)(OperationSubRowStyled,{layout:m,children:[(0,jsx_runtime_1.jsx)(common_1.SamplesMiddlePanel,{isStacked:g,children:(0,jsx_runtime_1.jsx)(RequestDetails_1.RequestDetails,{operation:k,translate:_})}),r&&(0,jsx_runtime_1.jsx)(OperationSamplesPanel,{isStacked:g,"data-testid":"samples-block",className:"panel-container-request-samples",children:(0,jsx_runtime_1.jsx)(RequestSamples_1.RequestSamples,{operation:k})})]}),(0,jsx_runtime_1.jsxs)(OperationSubRowStyled,{layout:m,children:[(0,jsx_runtime_1.jsx)(common_1.SamplesMiddlePanel,{isStacked:g,children:(null===(a=k.responses)||void 0===a?void 0:a.length)?(0,jsx_runtime_1.jsx)(Responses_1.OperationResponseList,{responses:k.responses,operationId:k.id,operationPointer:k.pointer,callbackId:k.callbackId,activeResponseTab:u,onTabChange:y}):null}),r&&(0,jsx_runtime_1.jsx)(OperationSamplesPanel,{isStacked:g,"data-testid":"samples-block",className:"panel-container-response-samples",children:(0,jsx_runtime_1.jsx)(ResponseSamples_1.ResponseSamples,{operation:k,activeResponseTab:u,onTabChange:y})})]}),(0,jsx_runtime_1.jsxs)(OperationSubRowStyled,{layout:m,children:[(0,jsx_runtime_1.jsxs)(common_1.SamplesMiddlePanel,{isStacked:g,children:[(null===(o=k.callbacks)||void 0===o?void 0:o.length)?(0,jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment,{children:[(0,jsx_runtime_1.jsxs)(OperationItemTitle_1.Title,{children:[(0,jsx_runtime_1.jsx)(LinkToField_1.LinkToField,{to:(0,services_1.makeDeepLink)(k.id,"callbacks")}),_("openapi.callbacks","Callbacks")]}),(0,jsx_runtime_1.jsx)(Callbacks_1.CallbacksList,{callbacks:k.callbacks,onExpand:O,selectedCallback:v})]}):null,(0,jsx_runtime_1.jsx)(RenderHook_1.RenderHook,{Hook:theme_1.AfterOpenApiOperation||(null==x?void 0:x.AfterOperation),props:{operation:k}})]}),v?(0,jsx_runtime_1.jsx)(OperationSamplesPanel,{isStacked:g,"data-testid":"samples-block",children:(0,jsx_runtime_1.jsx)(CallbackSamples_1.CallbackSamples,{callback:v,translate:_})}):null]}),(0,jsx_runtime_1.jsx)(OperationSubRowStyled,{layout:m,children:(0,jsx_runtime_1.jsx)(common_1.SamplesMiddlePanel,{isStacked:g,fullWidth:!0,children:C})})]})}exports.OperationItem=(0,react_1.memo)(OperationItemComponent);const OperationSamplesPanel=(0,styled_components_1.default)(common_1.SamplesPanel)`
  margin-left: auto;
  --code-block-padding: var(--spacing-xs) 0 var(--spacing-xs) 20px;
`,FeedbackWrapper=styled_components_1.default.div`
  & > div {
    flex: 1 1 auto;
    display: flex;
    justify-content: center;
  }

  & > div > div {
    width: 100%;
    max-width: var(--feedback-width);
  }
`,OperationRow=(0,styled_components_1.default)(common_1.Row)`
  flex-direction: column;
  align-items: flex-start;
  padding: var(--spacing-base) 0 calc(var(--spacing-xl) + var(--spacing-xs));
`,OperationSubRowStyled=(0,styled_components_1.default)(common_1.Row)`
  margin: calc(var(--spacing-unit) * 2) 0;
`;
//# sourceMappingURL=OperationItem.js.map