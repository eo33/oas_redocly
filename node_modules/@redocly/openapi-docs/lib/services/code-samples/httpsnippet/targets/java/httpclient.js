"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.info=void 0;const code_builder_1=require("../../helpers/code-builder"),__1=require("../.."),utils_1=require("../../../../utils"),code_helpers_1=require("../../helpers/code-helpers"),constants_1=require("../../helpers/constants"),constants_2=require("../../../../../constants"),hasQueryParams=e=>!(!e.uriObj.query||!Object.keys(e.uriObj.query).length),getBody=e=>e.postData&&e.postData.mimeType===constants_2.MediaTypes.URL_ENCODED?"HttpRequest.BodyPublishers.ofString(form)":e.postData?"HttpRequest.BodyPublishers.ofString(payload)":["POST","PUT","PATCH"].includes(e.method.toUpperCase())?'HttpRequest.BodyPublishers.ofString("some body text")':"",handler=function(e,t,{target:a,client:s}){var r,n,o;const p=Object.assign({indent:"  ",withWrapper:!0},t),i=new code_builder_1.CodeBuilder({indentation:p.indent,variablesPrefix:p.variablesPrefix,capitalize:!0,lang:constants_1.Lang.JAVA});if(p.withComments&&addComments(i,e),p.withImports&&addImports(i,e),p.withWrapper&&(i.push("public class App {"),i.push(1,"public static void main(String[] args) throws Exception {"),i.push(2,"var httpClient = HttpClient.newBuilder().build();"),i.blank()),null===(r=e.securityOAuth2ExtraCalls)||void 0===r?void 0:r.length){const t=new __1.HTTPSnippet(null===(n=e.securityOAuth2ExtraCalls)||void 0===n?void 0:n[0]).convert(a,s,Object.assign(Object.assign({},p),{withImports:!1,withWrapper:!1,withComments:!1,variablesPrefix:"oauth2"}));i.push(t),i.blank(),i.push(2,"var oauth2Response = httpClient.send(oauth2Request, HttpResponse.BodyHandlers.ofString());"),i.push(2,'var accessToken = new JSONObject(oauth2Response.body()).getString("access_token");'),i.blank()}if(e.postData)switch((0,utils_1.normalizeMimeType)(e.postData.mimeType)){case constants_2.MediaTypes.URL_ENCODED:e.postData.params&&(i.push(2,"HashMap<String, String> params = new HashMap<>();"),e.postData.params.forEach((e=>{i.push(2,'params.put("%s", "%s");',e.name,e.value)})),i.blank(),i.push(2,"var form = params.keySet().stream()"),i.push(3,'.map(key -> key + "=" + URLEncoder.encode(params.get(key), StandardCharsets.UTF_8))'),i.push(3,'.collect(Collectors.joining("&"));'),i.blank());break;case constants_2.MediaTypes.JSON:e.postData.jsonObj&&(i.push(2,`var payload = String.join("\\n"\n      ${(0,code_helpers_1.addIndentation)(JSON.stringify(e.postData.jsonObj,null,1).replace(/"/g,'\\"').replace(/^/gm,', "').replace(/$/gm,'"'),{level:3,indent:p.indent,firstLine:!1})}`),i.push(2,");"),i.blank());break;case constants_2.MediaTypes.XML:e.postData.text&&(i.push(2,'var payload = String.join("\\n"'),e.postData.text.trim().split("\n").forEach((e=>{const t=e.replace(/"/g,'\\"');i.push(3,`"${t}", `)})),i.push(2,");"),i.blank());break;case constants_2.MediaTypes.MULTIPART:e.postData.params&&(i.push(2,"var multipartBody = MultipartBodyPublisher.newBuilder();"),e.postData.params&&e.postData.params.forEach((e=>{i.push(2,'multipartBody.append("%s", "%s");',e.name,e.value)})),i.push(2,"var body = multipartBody.build();"),i.blank())}if(hasQueryParams(e)){i.push(2,"HashMap<String, String> params = new HashMap<>();");for(const[t,a]of Object.entries(e.uriObj.query))i.push(2,'params.put("%s", "%s");',t,a);i.blank(),i.push(2,"var query = params.keySet().stream()"),i.push(3,'.map(key -> key + "=" + URLEncoder.encode(params.get(key), StandardCharsets.UTF_8))'),i.push(3,'.collect(Collectors.joining("&"));'),i.blank()}i.push(2,`var ${i.var("host")} = "%s";`,e.uriObj.protocol+"//"+e.uriObj.host),(0,code_helpers_1.printUrlVariablesDeclarations)(e,i,2);const l=Object.assign(Object.assign({},e),{pathname:e.uriObj.pathname});i.push(2,`var ${i.var("pathname")} = %s;`,(0,code_helpers_1.buildUrlExpression)(l,i)),i.push(2,`var ${i.var("request")} = HttpRequest.newBuilder()`),"PATCH"===e.method.toUpperCase()?i.push(3,'.method("PATCH", %s)',getBody(e)):i.push(3,".%s(%s)",e.method.toUpperCase(),getBody(e)),i.push(3,`.uri(URI.create(${i.var("host")} + ${i.var("pathname")} %s))`,hasQueryParams(e)?"+ '?' + query":""),(null===(o=e.securityOAuth2ExtraCalls)||void 0===o?void 0:o.length)&&(e.allHeaders.Authorization='"Bearer " + accessToken');const u=Object.keys(e.allHeaders);if(u.length&&u.forEach((t=>{var a;i.push(3,'.header("%s", %s)',t,"Authorization"===t&&(null===(a=e.securityOAuth2ExtraCalls)||void 0===a?void 0:a.length)?e.allHeaders[t]:`"${e.allHeaders[t]}"`)})),e.basicAuth){const{username:t,password:a}=e.basicAuth;i.push(3,`.header("Authorization", "Basic " + Base64.getEncoder().encodeToString(("${t}:${a}").getBytes()))`)}return i.push(3,".build();"),p.withWrapper&&(i.blank(),i.push(2,"var response = httpClient.send(request, HttpResponse.BodyHandlers.ofString());"),i.blank(),i.push(2,"System.out.println(response.body());"),i.push(1,"}"),i.push("}")),i.join()};function addComments(e,t){var a;e.push("/**"),e.push(" * Requires JDK >= 11"),(null===(a=t.securityOAuth2ExtraCalls)||void 0===a?void 0:a.length)&&(e.push(" *"),e.push(' * Requires package "org.json" >= 20201115'),e.push(" * See here for installation details:"),e.push(" *  https://search.maven.org/artifact/org.json/json")),e.push(" */"),e.blank()}function addImports(e,t){var a,s,r,n;e.push("import java.net.*;"),e.push("import java.net.http.*;"),e.push("import java.util.*;"),((0,utils_1.normalizeMimeType)(null===(a=t.postData)||void 0===a?void 0:a.mimeType)===constants_2.MediaTypes.URL_ENCODED&&(null===(s=t.postData)||void 0===s?void 0:s.params)||(null===(r=t.securityOAuth2ExtraCalls)||void 0===r?void 0:r.length)||hasQueryParams(t))&&(e.push("import java.nio.charset.StandardCharsets;"),e.push("import java.util.stream.Collectors;")),(null===(n=t.securityOAuth2ExtraCalls)||void 0===n?void 0:n.length)&&e.push("import org.json.JSONObject;"),e.blank()}exports.info={key:"httpclient",title:"HttpClient",link:"https://docs.oracle.com/en/java/javase/11/docs/api/java.net.http/java/net/http/HttpClient.html",description:"HttpClient (Java SE 11 & JDK 11 )"},exports.default=handler;
//# sourceMappingURL=httpclient.js.map