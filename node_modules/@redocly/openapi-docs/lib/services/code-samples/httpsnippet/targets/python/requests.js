"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const util_1=require("util"),code_builder_1=require("../../helpers/code-builder"),utils_1=require("../../../../utils"),code_helpers_1=require("../../helpers/code-helpers"),__1=require("../.."),constants_1=require("../../helpers/constants"),constants_2=require("../../../../../constants"),handler=function(e,t,{target:s,client:a}){var o,n,r,i;const l=Object.assign({indent:"  "},t),{level:u=0}=l,p=new code_builder_1.CodeBuilder({indentation:l.indent,variablesPrefix:l.variablesPrefix,lang:constants_1.Lang.PYTHON});l.withComments&&addComments(p),l.withImports&&p.push("import requests").blank();let d,h,c,_=!1,b=e.allHeaders;if(null===(o=e.securityOAuth2ExtraCalls)||void 0===o?void 0:o.length){const t=new __1.HTTPSnippet(null===(n=e.securityOAuth2ExtraCalls)||void 0===n?void 0:n[0]).convert(s,a,Object.assign(Object.assign({},l),{withImports:!1,withComments:!1,variablesPrefix:"oauth2_"}));p.push(t),p.blank(),b=b||{},b.Authorization='"Bearer " + oauth2_data["access_token"]',_=!0}if((0,code_helpers_1.printUrlVariablesDeclarations)(e,p),p.push(`${p.var("url").toLowerCase()} = %s`,(0,code_helpers_1.buildUrlExpression)(e,p)).blank(),Object.keys(e.queryObj||{}).length){d="query = "+jsObjectToPythonDict(e.queryObj,l.indent),p.push(d).blank()}const v=(0,utils_1.normalizeMimeType)(null===(r=e.postData)||void 0===r?void 0:r.mimeType);if(e.postData)switch(v){case constants_2.MediaTypes.URL_ENCODED:h=e.postData.paramsObj?`${(0,code_helpers_1.addIndentation)(jsObjectToPythonDict(e.postData.paramsObj,l.indent),{level:0,firstLine:!1})}`:e.postData.text;break;case constants_2.MediaTypes.JSON:e.postData.jsonObj&&(h=(0,code_helpers_1.addIndentation)(jsObjectToPythonDict(e.postData.jsonObj,l.indent),{level:0,firstLine:!1}));break;case constants_2.MediaTypes.MULTIPART:const t=[];if(e.postData.params)for(const s of e.postData.params)t.push(`"${s.name}": "${s.value}"`);if(t.length){c=`data = {\n${t.map((e=>`  ${e}`)).join(",\n")}\n}`}c&&p.push(c).blank();break;default:e.postData.text&&(h=`'''\n${(0,code_helpers_1.addIndentation)(e.postData.text.trim(),{level:1,indent:l.indent,firstLine:!0})}\n'''`)}let $;h&&p.push(`${p.var("payload").toLowerCase()} = %s`,h).blank();const f=Object.keys(b).length,C=(e,t)=>"Authorization"===e&&_?t:`"${t}"`;if(1===f)for($ in b)p.push(`${p.var("headers").toLowerCase()} = {"${$}": ${C($,b[$])}}`).blank();else if(f>1){let e=1;for($ in p.push(`${p.var("headers").toLowerCase()} = {`),b)e++!==f?p.push(1,`"${$}": ${C($,b[$])},`):p.push(1,`"${$}": ${C($,b[$])}`);p.push(0,"}").blank()}const j=e.method.toLowerCase();let m=(0,util_1.format)(`${p.var("response").toLowerCase()} = requests.${j}(${p.var("url").toLowerCase()}`);if(v===constants_2.MediaTypes.MULTIPART&&c&&(m+=", data=data"),h){m+=`, ${v===constants_2.MediaTypes.JSON?"json":"data"}=${p.var("payload").toLowerCase()}`}return f>0&&(m+=`, headers=${p.var("headers").toLowerCase()}`),d&&(m+=`, params=${p.var("query").toLowerCase()}`),e.basicAuth&&(m+=`, auth=('${e.basicAuth.username}','${e.basicAuth.password}')`),m+=")",p.push(m).blank(),(null===(i=e.allResponseCodes)||void 0===i?void 0:i.includes("204"))?p.push("if response.status_code == 204:").push(u+1,'print("success")').push("else:").push(u+1,`${p.var("data").toLowerCase()} = ${p.var("response").toLowerCase()}.json()`).push(u+1,`print(${p.var("data").toLowerCase()})`):p.push(`${p.var("data").toLowerCase()} = ${p.var("response").toLowerCase()}.json()`).push(`print(${p.var("data").toLowerCase()})`),p.join()};function addComments(e){e.push('"""'),e.push("Requires python >= 3"),e.blank(),e.push('Requires module "requests" >= 2.25.1'),e.push("See here for installation details:"),e.push("  https://requests.readthedocs.io/"),e.push('"""'),e.blank()}function jsObjectToPythonDict(e,t){return JSON.stringify(e,(function(e,t){return e&&"boolean"==typeof t?t?"__REDOCLY_<True>__":"__REDOCLY_<False>__":null===t?"__REDOCLY_<None>__":t}),t).replace(/"__REDOCLY_<(\w+)>__"/g,"$1")}exports.default=handler;
//# sourceMappingURL=requests.js.map