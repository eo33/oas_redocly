"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.info=void 0;const code_builder_1=require("../../helpers/code-builder"),__1=require("../.."),constants_1=require("../../helpers/constants"),code_helpers_1=require("../../helpers/code-helpers"),utils_1=require("../../../../utils"),constants_2=require("../../../../../constants"),indent=1;function hasMimeType(e={},s){return(0,utils_1.normalizeMimeType)(e.mimeType)===s}const handler=function(e,s,{target:t,client:a}){var r,i,n,o,p,l;const u=Object.assign({capitalize:!0,showBoilerplate:!0,checkErrors:!0,printBody:!0,timeout:-1,indent:"  "},s),h=null===(r=e.securityOAuth2ExtraCalls)||void 0===r?void 0:r[0],d=u.checkErrors?"err":"_",c=e.method.toUpperCase(),v=new code_builder_1.CodeBuilder({indentation:u.indent,variablesPrefix:u.variablesPrefix,capitalize:u.capitalize,lang:constants_1.Lang.GO}),y=()=>{u.checkErrors&&v.push(1,"if err != nil {").push(2,"panic(err)").push(1,"}")};if(u.showBoilerplate&&(v.push("package main").blank().push("import (").push(1,'"fmt"'),u.timeout>0&&v.push(1,'"time"'),h&&v.push(1,'"encoding/json"'),hasMimeType(e.postData,constants_2.MediaTypes.MULTIPART)&&(v.push(1,'"mime/multipart"'),v.push(1,'"io"'),v.push(1,'"bytes"')),(hasMimeType(e.postData,constants_2.MediaTypes.URL_ENCODED)||hasMimeType(null===(n=null===(i=e.securityOAuth2ExtraCalls)||void 0===i?void 0:i[0])||void 0===n?void 0:n.postData,constants_2.MediaTypes.URL_ENCODED))&&(v.push(1,'"net/url"'),v.push(1,'"strconv"')),(hasMimeType(e.postData,constants_2.MediaTypes.JSON)||hasMimeType(null===(p=null===(o=e.securityOAuth2ExtraCalls)||void 0===o?void 0:o[0])||void 0===p?void 0:p.postData,constants_2.MediaTypes.JSON))&&v.push(1,'"bytes"'),(e.postData&&!hasMimeType(e.postData,constants_2.MediaTypes.JSON)||h)&&v.push(1,'"strings"'),v.push(1,'"net/http"'),u.printBody&&v.push(1,'"io/ioutil"'),v.push(")").blank().push("func main() {")),Object.keys(e.allHeaders).length&&Object.keys(e.allHeaders).forEach((s=>{e.allHeaders[s]=`"${e.allHeaders[s]}"`})),h){const s="oAuth2",r=u.checkErrors?`${d} := `:"",i=u.capitalize?"Res":"res",n=new __1.HTTPSnippet(h).convert(t,a,Object.assign(Object.assign({},u),{printBody:!1,variablesPrefix:s,showBoilerplate:!1}));v.push(n).blank().push(1,`var ${s}${i}Body struct {`).push(2,"Access_token string").push(1,"}").push(1,`${r}json.NewDecoder(${s}${i}.Body).Decode(&${s}${i}Body)`).blank(),y(),e.allHeaders.Authorization=`"Bearer " + ${s}${i}Body.Access_token`}if((0,code_helpers_1.printUrlVariablesDeclarations)(e,v,1),u.timeout>0&&(a=v.var("client"),v.push(1,"%s := http.Client{",a).push(2,"Timeout: time.Duration(%s * time.Second),",u.timeout).push(1,"}").blank()),v.push(1,`${v.var("reqUrl")} := ${(0,code_helpers_1.buildUrlExpression)(e,v)}`),e.postData){let s;switch((0,utils_1.normalizeMimeType)(e.postData.mimeType)){case constants_2.MediaTypes.URL_ENCODED:v.push(1,"%s := url.Values{}",v.var("data")),e.postData.params.forEach((e=>{v.push(1,'%s.Set("%s", "%s")',v.var("data"),e.name,e.value)})),v.push(1,'%s, %s := http.NewRequest("%s", %s, strings.NewReader(%s.Encode()))',v.var("req"),d,c,v.var("reqUrl"),v.var("data")),e.allHeaders["Content-Length"]=`strconv.Itoa(len(${v.var("data")}.Encode()))`;break;case constants_2.MediaTypes.JSON:s=JSON.stringify(e.postData.jsonObj,null,2).split("\n").map((e=>u.indent+e)).join("\n").trim(),v.push(1,`var ${v.var("data")} = []byte(\`${s}\`)`),v.push(1,'%s, %s := http.NewRequest("%s", %s, bytes.NewBuffer(%s))',v.var("req"),d,c,v.var("reqUrl"),v.var("data"));break;case constants_2.MediaTypes.MULTIPART:v.push(1,"%s := &bytes.Buffer{}",v.var("data")).push(1,"writer := multipart.NewWriter(%s)",v.var("data")),e.postData.params.forEach((e=>{if(!e.fileName&&!e.contentType)return v.push(1,'%s, _ := writer.CreateFormField("%s")',v.var(`${e.name}Fw`),e.name).push(1,'_, %s = io.Copy(%s, strings.NewReader("%s"))',d,v.var(`${e.name}Fw`),e.value),void y();e.fileName&&(v.push(1,'%s, %s = writer.CreateFormFile("%s", "%s")',v.var(`${e.name}Fw`),d,e.name,e.fileName),y())})),v.push(1,"writer.Close()").blank().push(1,"%s := bytes.NewReader(%s.Bytes())",v.var("payload"),v.var("data")).push(1,'%s, %s := http.NewRequest("%s", %s, %s)',v.var("req"),d,c,v.var("reqUrl"),v.var("payload")),e.allHeaders["Content-Type"]="writer.FormDataContentType()";break;default:e.postData.text&&v.push(1,"%s := strings.NewReader(%s)",v.var("payload"),JSON.stringify(null===(l=e.postData)||void 0===l?void 0:l.text)).push(1,'%s, %s := http.NewRequest("%s", %s, %s)',v.var("req"),d,c,v.var("reqUrl"),v.var("payload"))}}else v.push(1,'%s, %s := http.NewRequest("%s", %s, nil)',v.var("req"),d,c,v.var("reqUrl"));if(Object.getOwnPropertyNames(e.queryObj).length){v.blank().push(1,`${v.var("query")} := ${v.var("req")}.URL.Query()`);for(const s in e.queryObj){const t=e.queryObj[s],a="string"==typeof t&&/^\[.*\]$/.test(t)?`\`${t}\``:`"${t}"`;v.push(1,`${v.var("query")}.Add("${s}", ${a})`)}v.push(1,`${v.var("req")}.URL.RawQuery = ${v.var("query")}.Encode()`).blank()}if(y(),e.basicAuth){const{username:s,password:t}=e.basicAuth;v.push(1,`%s.SetBasicAuth("${s}", "${t}")`,v.var("req"))}return Object.keys(e.allHeaders).length&&Object.keys(e.allHeaders).forEach((s=>{v.push(1,'%s.Header.Add("%s", %s)',v.var("req"),s,e.allHeaders[s])})),v.push(1,"%s, %s := %s.Do(%s)",v.var("res"),d,a,v.var("req")),y(),u.printBody&&(v.push(1,"defer %s.Body.Close()",v.var("res")).push(1,"%s, %s := ioutil.ReadAll(%s.Body)",v.var("body"),d,v.var("res")),y()),v.blank().push(1,"fmt.Println(%s)",v.var("res")),u.printBody&&v.push(1,"fmt.Println(string(%s))",v.var("body")),u.showBoilerplate&&v.push("}"),v.join()};exports.info={key:"native",title:"NewRequest",link:"http://golang.org/pkg/net/http/#NewRequest",description:"Golang HTTP client request"},exports.default=handler;
//# sourceMappingURL=native.js.map