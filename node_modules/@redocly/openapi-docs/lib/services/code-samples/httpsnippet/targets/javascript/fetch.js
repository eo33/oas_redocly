"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.info=void 0;const stringify_object_1=__importDefault(require("stringify-object")),code_builder_1=require("../../helpers/code-builder"),code_helpers_1=require("../../helpers/code-helpers"),utils_1=require("../../../../utils"),__1=require("../.."),constants_1=require("../../helpers/constants"),constants_2=require("../../../../../constants"),handler=function(e,t,{target:s,client:a}){var n,r,i,o,l;const d=Object.assign({indent:"  ",credentials:null},t),c=new code_builder_1.CodeBuilder({indentation:d.indent,variablesPrefix:d.variablesPrefix,capitalize:!0,lang:constants_1.Lang.JAVASCRIPT}),p={method:e.method.toUpperCase()};Object.keys(e.headersObj).length&&(p.headers=e.headersObj);let u=!1;if(d.withComments&&addComments(c),null===(n=e.securityOAuth2ExtraCalls)||void 0===n?void 0:n.length){const t=new __1.HTTPSnippet(null===(r=e.securityOAuth2ExtraCalls)||void 0===r?void 0:r[0]).convert(s,a,Object.assign(Object.assign({},d),{withImports:!1,withComments:!1,variablesPrefix:"oAuth2"}));c.push(t),c.blank(),p.headers=p.headers||{},p.headers.Authorization="'Bearer ' + oAuth2Data.access_token",u=!0}null!==d.credentials&&(p.credentials=d.credentials);const h=Object.getOwnPropertyNames(e.queryObj).length;if(h&&c.push(`const ${c.var("query")} = new URLSearchParams(${(0,stringify_object_1.default)(e.queryObj,{indent:d.indent,inlineCharacterLimit:25})}).toString();`).blank(),e.postData)switch((0,utils_1.normalizeMimeType)(e.postData.mimeType)){case constants_2.MediaTypes.URL_ENCODED:p.body=e.postData.paramsObj?`new URLSearchParams(${c.var("formData")}).toString()`:e.postData.text,e.postData.paramsObj&&c.push(`const ${c.var("formData")} = ${(0,code_helpers_1.addIndentation)((0,stringify_object_1.default)(e.postData.paramsObj,{indent:d.indent,inlineCharacterLimit:25}),{level:0,firstLine:!1})};`).blank();break;case constants_2.MediaTypes.JSON:e.postData.jsonObj&&(p.body=`JSON.stringify(${(0,code_helpers_1.addIndentation)((0,stringify_object_1.default)(e.postData.jsonObj,{indent:d.indent,inlineCharacterLimit:25}),{level:1,firstLine:!1})})`);break;case constants_2.MediaTypes.MULTIPART:c.push(`const ${c.var("form")} = new FormData();`),null===(i=null==p?void 0:p.headers)||void 0===i||delete i["Content-Type"],e.postData.params.forEach((function(e){c.push(`${c.var("form")}.append(%s, %s);`,JSON.stringify(e.name),JSON.stringify(e.value||e.fileName||""))})),p.body=c.var("form"),c.blank();break;default:e.postData.text&&(p.body=`\`${(0,code_helpers_1.addIndentation)(e.postData.text,{level:2,indent:d.indent,firstLine:!1}).trim()}\``)}const _=p.headers&&p.headers.Accept&&(0,utils_1.normalizeMimeType)(p.headers.Accept)===constants_2.MediaTypes.JSON||(0,utils_1.normalizeMimeType)(null===(o=e.postData)||void 0===o?void 0:o.mimeType)===constants_2.MediaTypes.JSON;if(e.basicAuth){const{username:t,password:s}=e.basicAuth;p.headers=p.headers||{},p.headers.Authorization=`'Basic ' + btoa('${t}:${s}')`,u=!0}(0,code_helpers_1.printUrlVariablesDeclarations)(e,c);const m=(0,code_helpers_1.buildUrlExpression)(e,c);return c.push(`const ${c.var("resp")} = await fetch(`).push(1,"`"+m+(h?"?${"+c.var("query")+"}":"")+"`,").push((0,code_helpers_1.addIndentation)((0,stringify_object_1.default)(p,{indent:d.indent,inlineCharacterLimit:25,transform:(0,code_helpers_1.getPreserveTransformer)({body:!0,authorizationHeader:u})}),{level:1,indent:d.indent})).push(");").blank(),(null===(l=e.allResponseCodes)||void 0===l?void 0:l.includes("204"))?(c.push("if (resp.status === 204) {").push(1,"console.log('success');").push("} else {"),c.push(1,`const ${c.var("data")} = await ${c.var("resp")}.${_?"json()":"text()"};`).push(1,`console.log(${c.var("data")});`).push("}")):c.push(`const ${c.var("data")} = await ${c.var("resp")}.${_?"json()":"text()"};`).push(`console.log(${c.var("data")});`),c.join()};function addComments(e){e.push("/**"),e.push(" * Requires ES8-compatible browser: https://caniuse.com/async-functions"),e.push(" */"),e.blank()}exports.info={key:"fetch",title:"fetch",link:"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch",description:"Perform asynchronous HTTP requests with the Fetch API"},exports.default=handler;
//# sourceMappingURL=fetch.js.map