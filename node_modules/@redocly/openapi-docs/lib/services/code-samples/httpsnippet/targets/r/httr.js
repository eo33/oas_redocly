"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const code_builder_1=require("../../helpers/code-builder"),code_helpers_1=require("../../helpers/code-helpers"),constants_1=require("../../helpers/constants"),__1=require("../.."),utils_1=require("../../../../utils"),constants_2=require("../../../../../constants"),utils_2=require("./utils"),indent=1,handler=function(e,s,{target:t,client:a}){var r,o,n,i;const l=Object.assign({indent:"  ",showBoilerplate:!0,printBody:!0},s),u=new code_builder_1.CodeBuilder({indentation:l.indent,variablesPrefix:l.variablesPrefix,lang:constants_1.Lang.R}),p=e.method.toUpperCase(),c=null===(r=e.securityOAuth2ExtraCalls)||void 0===r?void 0:r[0];if(l.showBoilerplate&&u.push("library(httr)").blank(),c){const s="oauth2_",r=new __1.HTTPSnippet(c).convert(t,a,Object.assign(Object.assign({},l),{variablesPrefix:s,showBoilerplate:!1})),o=`${s}data_req`;u.push(r).push(`access_token = content(${o}, "parsed")$access_token`).blank(),e.allHeaders.Authorization='paste("Bearer", access_token)'}let d,h="";if(null==e?void 0:e.postData)switch((0,utils_1.normalizeMimeType)(null===(o=null==e?void 0:e.postData)||void 0===o?void 0:o.mimeType)){case constants_2.MediaTypes.URL_ENCODED:{d="form",h=u.var("body");const s=(0,utils_2.postDataToRListBody)(e.postData.params,l);u.push(`${h} <- list(${s})`).blank();break}case constants_2.MediaTypes.JSON:{d="json",h=u.var("body");const s=(0,utils_2.objectToRString)(e.postData.jsonObj,l);u.push(`${h} = '${s}'`).blank();break}case constants_2.MediaTypes.MULTIPART:{d="multipart",h=u.var("body");const s=(0,utils_2.postDataToRListBody)(e.postData.params,l);u.push(`${h} <- list(${s})`).blank();break}default:(null===(n=e.postData)||void 0===n?void 0:n.text)&&(h=u.var("body"),d="raw",u.push(`${h} = ${(0,utils_2.objectToRString)(null===(i=e.postData)||void 0===i?void 0:i.text)}`).blank())}(0,code_helpers_1.printUrlVariablesDeclarations)(e,u),Object.keys(Object.assign(Object.assign({},e.pathParameters),e.serverVariables)).length&&u.blank().push("# create you own operator").push('"%&%" <- function(x, y)paste0(x,y)').blank();const b=(0,code_helpers_1.buildUrlExpression)(e,u);u.push(`url = ${b}`).blank();const _=u.var("data_req");if(u.push(`${_} <- ${p}(`),u.push(1,"url,"),e.basicAuth){const{username:s,password:t}=e.basicAuth;u.push(1,`authenticate("${s}", "${t}")`)}if(Object.keys(e.allHeaders).length){const s=`${Object.keys(e.allHeaders).map((s=>`"${s}" = ${e.allHeaders[s].startsWith("paste")?e.allHeaders[s]:`"${e.allHeaders[s]}"`}`)).join(", ")}`;s&&u.push(1,`add_headers(${s}),`)}return h&&(u.push(1,`body = ${h},`),u.push(1,`encode = "${d}",`)),u.push(1,"verbose()"),u.push(")"),l.printBody&&u.blank().push(`content(${_}${"raw"===d?', "text"':""})`),u.join()};exports.default=handler;
//# sourceMappingURL=httr.js.map