"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.info=void 0;const code_builder_1=require("../../helpers/code-builder"),index_1=require("../../index"),utils_1=require("../../../../utils"),generator_1=require("../../../generator"),constants_1=require("../../helpers/constants"),code_helpers_1=require("../../helpers/code-helpers"),constants_2=require("../../../../../constants"),handler=function(t,e,{target:s,client:a}){var r,i;const n=Object.assign({indent:"  ",withWrapper:!0},e),p=new code_builder_1.CodeBuilder({indentation:n.indent,variablesPrefix:n.variablesPrefix,capitalize:!0,lang:constants_1.Lang.JAVA8}),o=formatHttpMethod(t.method);if(n.withComments&&addComments(p),n.withImports&&addImports(p,t),n.withWrapper&&(p.push("public class App {"),p.push(1,"public static void main(String[] args ) throws java.io.IOException {"),p.push(2,"HttpClient httpClient = HttpClientBuilder.create().build();"),p.blank()),null===(r=t.securityOAuth2ExtraCalls)||void 0===r?void 0:r.length){const e=new index_1.HTTPSnippet(null===(i=t.securityOAuth2ExtraCalls)||void 0===i?void 0:i[0]).convert(s,a,Object.assign(Object.assign({},n),{withImports:!1,withWrapper:!1,withComments:!1,variablesPrefix:"oauth2"}));p.push(e),p.push(2,"JSONObject %s = new JSONObject(EntityUtils.toString(httpClient.execute(%s).getEntity()));","oauth2Response","oauth2Request"),p.push(2,'String accessToken = %s.getString("access_token");',"oauth2Response"),p.blank()}(0,code_helpers_1.printUrlVariablesDeclarations)(t,p,2);const u=(0,code_helpers_1.buildUrlExpression)(t,p);p.push(2,`%s ${p.var("request")} = new %s(%s);`,o,o,u);const h=Object.keys(t.allHeaders);if(!h.length||t.postData&&t.postData.mimeType==constants_2.MediaTypes.MULTIPART||h.forEach((e=>{var s;p.push(2,'%s.setHeader("%s", %s);',p.var("request"),e,(null===(s=t.securityOAuth2ExtraCalls)||void 0===s?void 0:s.length)?'"Bearer " + accessToken':`"${t.allHeaders[e]}"`)})),t.basicAuth){const{username:e,password:s}=t.basicAuth;p.push(2,`String encodedString = Base64.getEncoder().encodeToString("${e}:${s}".getBytes());`),p.push(2,'%s.setHeader("%s", "%s"+encodedString);',p.var("request"),"Authorization","Basic ")}if(t.postData)switch((0,utils_1.normalizeMimeType)(t.postData.mimeType)){case constants_2.MediaTypes.URL_ENCODED:t.postData.params&&(p.blank(),p.push(2,"List<NameValuePair> params = new ArrayList<NameValuePair>();"),t.postData.params.forEach((t=>{p.push(2,'params.add(new BasicNameValuePair("%s", "%s"));',t.name,t.value)})),p.push(2,"%s.setEntity(new UrlEncodedFormEntity(params));",p.var("request")),p.blank());break;case constants_2.MediaTypes.MULTIPART:t.postData.params&&(p.push(2,"MultipartEntity reqEntity = new MultipartEntity();"),t.postData.params.forEach((t=>{p.push(2,'reqEntity.addPart("%s", %s);',t.name,isString(t.value)?`new StringBody("${t.value}")`:t.value)})),p.push(2,"%s.setEntity(reqEntity);",p.var("request")));break;case constants_2.MediaTypes.JSON:if(t.postData.jsonObj){p.push(2,"JSONObject payload = new JSONObject();");for(const[e,s]of Object.entries(t.postData.jsonObj))Array.isArray(s)?(p.push(2,'payload.put("%s", new JSONArray()',e),s.forEach((t=>{isObject(t)?(p.push(3,".put(new JSONObject()"),c(t,4),p.push(3,")")):p.push(3,".put(%s)",formatValue(t))})),p.push(2,");")):isObject(s)?(p.push(2,'payload.put("%s", new JSONObject()%s',e,(0,utils_1.isEmptyObject)(s)?");":""),c(s,3),(0,utils_1.isEmptyObject)(s)||p.push(2,");")):p.push(2,'payload.put("%s", %s);',e,formatValue(s));p.push(2,"%s.setEntity(new StringEntity(payload.toString()));",p.var("request"))}break;case constants_2.MediaTypes.XML:t.postData.text&&(p.push(2,'String payload = String.join("\\n"'),t.postData.text.trim().split("\n").forEach((t=>{const e=t.replace(/"/g,'\\"');p.push(3,`"${e}", `)})),p.push(2,");"),p.push(2,"%s.setEntity(new StringEntity(payload));",p.var("request")))}return n.withWrapper&&(p.push(2,`String ${p.var("response")} = EntityUtils.toString(httpClient.execute(request).getEntity());`),p.blank(),p.push(2,"System.out.println(response);"),p.push(1,"}"),p.push("}")),p.join();function c(t,e){for(const[s,a]of Object.entries(t))isObject(a)?(p.push(e,'.put("%s", new JSONObject()',s),c(a,e+1),p.push(e,")")):p.push(e,'.put("%s", %s)',s,formatValue(a))}};function addComments(t){t.push("/**"),t.push(" * Requires JDK >= 8"),t.push(" *"),t.push(" * Requires Apache HttpComponents Client >= 4.3.5"),t.push(" * See here for installation details:"),t.push(" *   https://search.maven.org/artifact/org.apache.httpcomponents/httpcomponents-client"),t.push(" *"),t.push(' * Requires package "junit4"'),t.push(" * See here for installation details:"),t.push(" *   https://junit.org/junit4"),t.push(" *"),t.push(' * Requires package "org.json" >= 20180130'),t.push(" * See here for installation details:"),t.push(" *   https://search.maven.org/artifact/org.json/json"),t.push(" */"),t.blank()}function addImports(t,e){var s,a,r;t.push("import org.apache.http.util.EntityUtils;"),t.push("import org.apache.http.NameValuePair;"),t.push("import org.apache.http.client.HttpClient;"),t.push("import org.apache.http.client.entity.UrlEncodedFormEntity;"),e.method&&addHttpMethodImport(t,e.method),(null===(s=e.securityOAuth2ExtraCalls)||void 0===s?void 0:s.length)&&(null===(a=e.securityOAuth2ExtraCalls)||void 0===a?void 0:a[0].method.toLowerCase())!==e.method.toLowerCase()&&addHttpMethodImport(t,null===(r=e.securityOAuth2ExtraCalls)||void 0===r?void 0:r[0].method),t.push("import org.apache.http.impl.client.HttpClientBuilder;"),t.push("import org.apache.http.message.BasicNameValuePair;"),t.push("import org.apache.http.entity.StringEntity;"),t.push("import org.json.JSONObject;"),t.push("import org.json.JSONArray;"),t.push("import java.util.ArrayList;"),t.push("import java.util.List;"),t.push("import org.apache.http.entity.mime.MultipartEntity;"),t.push("import org.apache.http.entity.mime.content.StringBody;"),e.basicAuth&&t.push("import java.util.Base64;"),t.blank()}function addHttpMethodImport(t,e){const s=formatHttpMethod(e);t.push(`import org.apache.http.client.methods.${s};`)}function formatHttpMethod(t){return"Http"+(0,generator_1.capitalizeFirst)(t.toLowerCase())}function isString(t){return"[object String]"===Object.prototype.toString.call(t)}function isObject(t){const e=typeof t;return"function"===e||"object"===e&&!!t}function formatValue(t){return isString(t)?JSON.stringify(t):null==t?"JSONObject.NULL":t}exports.info={key:"apachehttp",title:"Apache http",link:"https://hc.apache.org/httpcomponents-client-4.5.x/",description:"Apache HttpClient"},exports.default=handler;
//# sourceMappingURL=apachehttp.js.map