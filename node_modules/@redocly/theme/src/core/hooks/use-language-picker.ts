import type { L10nConfig } from '@redocly/theme/core/types';

import { useThemeHooks } from '@redocly/theme/core/hooks';
import { getPathnameForLocale, withPathPrefix } from '@redocly/theme/core/utils';

export function useLanguagePicker(): {
  currentLocale: L10nConfig['locales'][number] | undefined;
  locales: L10nConfig['locales'];
  setLocale: (value: string) => void;
} {
  const { useL10nConfig, usePreloadHistory } = useThemeHooks();
  const history = usePreloadHistory();
  const { currentLocale, locales, defaultLocale } = useL10nConfig();

  const locale = locales.find((l) => l.code === currentLocale);

  function setLocale(value: string) {
    const newLangPathname = withPathPrefix(
      getPathnameForLocale(location.pathname, defaultLocale, value, locales),
    );

    const newUrlWithLanguage = `${newLangPathname}${location.search}${location.hash}`;
    history.push(newUrlWithLanguage);
  }

  return {
    currentLocale: locale,
    locales,
    setLocale,
  };
}
